<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AETERNA: OMEGA v10.0 | LEVIATHAN EDITION</title>
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Teko:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- VISUAL CORE (ULTRA-PREMIUM CYBER-STRATEGY STYLE) --- */
        :root {
            --bg-deep: #020305;
            --bg-panel: #0a0d14;
            --bg-header: #10151c;
            --overlay: rgba(8, 11, 16, 0.98);
            
            --c-blue: #00f3ff;
            --c-cyan: #00d4ff;
            --c-gold: #ffcc00;
            --c-red: #ff3333;
            --c-green: #00ff88;
            --c-purple: #bc13fe;
            --c-orange: #ff8800;
            --c-grey: #6b7280;
            --c-danger: #ff0055;
            
            --border: 1px solid rgba(255, 255, 255, 0.08);
            --border-glow: 1px solid rgba(0, 243, 255, 0.3);
            --font-head: 'Teko', sans-serif;
            --font-ui: 'Rajdhani', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            --shadow-glow: 0 0 15px rgba(0, 243, 255, 0.15);
        }

        /* Base Reset */
        * { box-sizing: border-box; user-select: none; outline: none; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--c-blue); }

        body {
            background-color: var(--bg-deep);
            color: #e2e8f0;
            font-family: var(--font-ui);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-image: 
                radial-gradient(circle at 50% 50%, #111827 0%, #000 100%),
                url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        /* --- TOP COMMAND HUD --- */
        #top-hud {
            height: 75px;
            background: var(--bg-header);
            border-bottom: var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.9);
            z-index: 1000;
            position: relative;
        }

        .hud-logo {
            font-family: var(--font-head);
            font-size: 36px;
            line-height: 1;
            color: #fff;
            letter-spacing: 3px;
            text-shadow: 0 0 15px var(--c-blue);
            border-right: 1px solid #333;
            padding-right: 20px;
            margin-right: 10px;
        }

        .hud-metrics { display: flex; align-items: center; gap: 20px; flex: 1; }
        
        .metric-box {
            display: flex; flex-direction: column; min-width: 80px; position: relative;
            cursor: pointer; transition: transform 0.2s;
        }
        .metric-box:hover { transform: translateY(-2px); }
        .metric-box .val { font-family: var(--font-mono); font-weight: 700; font-size: 16px; color: #fff; }
        .metric-box .lbl { font-size: 10px; color: var(--c-grey); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .metric-box .change { font-size: 10px; position: absolute; top: -12px; right: 0; }
        .change.pos { color: var(--c-green); }
        .change.neg { color: var(--c-red); }

        .time-controls {
            display: flex; background: #000; border: 1px solid #333; border-radius: 6px; overflow: hidden; padding: 2px;
        }
        .time-btn {
            background: transparent; border: none; color: #555; width: 38px; height: 32px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 14px; transition: 0.3s;
        }
        .time-btn:hover { color: #fff; background: #222; }
        .time-btn.active { background: var(--c-blue); color: #000; font-weight: 800; box-shadow: 0 0 10px var(--c-blue); }
        .time-btn.paused { color: var(--c-red); animation: blink 1s infinite; }

        .defcon-indicator {
            font-family: var(--font-head); font-size: 24px; padding: 0 15px; height: 40px;
            display: flex; align-items: center; border: 2px solid var(--c-red); border-radius: 4px;
            color: var(--c-red); background: rgba(255,0,0,0.05); text-shadow: 0 0 10px var(--c-red);
            cursor: pointer; transition: 0.3s;
        }
        .defcon-indicator:hover { background: var(--c-red); color: #000; box-shadow: 0 0 20px var(--c-red); }

        /* --- MAIN VIEWPORT GRID --- */
        #viewport {
            flex: 1;
            display: grid;
            grid-template-columns: 420px 1fr 380px;
            gap: 2px;
            background: #1a202c;
            overflow: hidden;
        }

        .side-panel { background: var(--bg-panel); display: flex; flex-direction: column; overflow: hidden; border-right: var(--border); }
        .main-canvas-area { position: relative; background: #05070a; overflow: hidden; }

        /* Tabs System */
        .tab-nav {
            display: flex; background: #080b11; border-bottom: var(--border);
        }
        .tab-trigger {
            flex: 1; background: transparent; border: none; color: #64748b; height: 45px;
            font-family: var(--font-head); font-size: 20px; cursor: pointer; position: relative;
            transition: 0.3s;
        }
        .tab-trigger:hover { color: #fff; background: rgba(255,255,255,0.02); }
        .tab-trigger.active { color: var(--c-blue); background: rgba(0,243,255,0.03); }
        .tab-trigger.active::after { content:''; position: absolute; bottom:0; left:0; width:100%; height:2px; background: var(--c-blue); box-shadow: 0 0 10px var(--c-blue); }

        .tab-content { padding: 15px; overflow-y: auto; flex: 1; display: none; }
        .tab-content.active { display: block; animation: slideIn 0.3s ease-out; }

        /* Cards & Widgets */
        .widget {
            background: rgba(15, 23, 42, 0.4); border: var(--border); border-radius: 4px;
            margin-bottom: 12px; padding: 12px; position: relative;
            backdrop-filter: blur(5px);
        }
        .widget-header {
            font-family: var(--font-head); font-size: 20px; color: var(--c-gold);
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px;
        }
        .widget-header span { font-size: 11px; font-family: var(--font-mono); color: var(--c-grey); }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        .stat-item { background: rgba(0,0,0,0.3); padding: 8px; border-radius: 2px; border-left: 2px solid var(--c-blue); }
        .stat-item .val { display: block; font-family: var(--font-mono); font-size: 15px; color: #fff; }
        .stat-item .lbl { display: block; font-size: 9px; color: var(--c-grey); text-transform: uppercase; font-weight: 700; }

        /* Resource Grid */
        .res-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px; }
        .res-box { 
            background: #000; border: 1px solid #222; padding: 5px; text-align: center;
            transition: 0.2s; cursor: help;
        }
        .res-box:hover { border-color: var(--c-blue); }
        .res-box i { font-size: 14px; margin-bottom: 3px; color: var(--c-cyan); }
        .res-box .val { display: block; font-size: 12px; font-weight: 700; font-family: var(--font-mono); }
        .res-box .lbl { display: block; font-size: 8px; color: #555; text-transform: uppercase; }

        /* UI Controls */
        .btn {
            width: 100%; padding: 10px; background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid #334155; color: #cbd5e1; font-family: var(--font-ui);
            font-weight: 700; font-size: 13px; text-align: left; cursor: pointer; border-radius: 4px;
            margin-bottom: 6px; position: relative; overflow: hidden; transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn:hover:not(:disabled) { border-color: var(--c-blue); color: #fff; background: #1e293b; box-shadow: 0 0 10px rgba(0, 243, 255, 0.1); }
        .btn:active:not(:disabled) { transform: scale(0.98); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .btn-tag { font-size: 9px; font-family: var(--font-mono); background: #000; padding: 2px 5px; border-radius: 3px; color: var(--c-gold); border: 1px solid #444; }

        .btn-danger { border-left: 3px solid var(--c-red); }
        .btn-danger:hover { background: rgba(255, 0, 0, 0.1); border-color: var(--c-red); }
        .btn-action { border-left: 3px solid var(--c-blue); }

        /* PROGRESS BARS */
        .progress-wrapper { height: 6px; background: #000; border-radius: 10px; overflow: hidden; margin: 5px 0 10px 0; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* MAP OVERLAYS */
        #map-controls { position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 8px; z-index: 100; }
        .map-mode-btn { 
            background: rgba(0,0,0,0.8); border: 1px solid #333; color: #888; padding: 8px 15px; 
            font-size: 11px; font-weight: 800; text-transform: uppercase; cursor: pointer; backdrop-filter: blur(5px);
            transition: 0.3s; border-radius: 2px; text-align: left; width: 140px;
        }
        .map-mode-btn.active { border-color: var(--c-blue); color: var(--c-blue); border-left: 4px solid var(--c-blue); }

        #province-info {
            position: absolute; bottom: 30px; left: 30px; width: 320px;
            background: var(--overlay); border: 1px solid var(--c-blue); padding: 15px;
            display: none; z-index: 500; box-shadow: 0 0 40px #000; border-radius: 4px;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85);
            display: none; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(8px);
        }
        .modal {
            width: 700px; max-height: 90vh; background: var(--bg-panel); border: 1px solid #333;
            display: flex; flex-direction: column; box-shadow: 0 0 100px rgba(0,0,0,1); animation: modalIn 0.2s ease-out;
        }
        .modal-head { background: #1a202c; padding: 15px 20px; font-family: var(--font-head); font-size: 28px; color: #fff; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .modal-body { padding: 20px; overflow-y: auto; color: #cbd5e1; font-size: 15px; line-height: 1.6; }
        .modal-foot { padding: 15px 20px; border-top: 1px solid #333; background: #080b11; display: flex; justify-content: flex-end; gap: 10px; }

        /* TICKER */
        #news-ticker {
            height: 30px; background: var(--c-gold); color: #000; display: flex; align-items: center;
            overflow: hidden; white-space: nowrap; font-family: var(--font-mono); font-weight: 800; font-size: 12px;
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 2000; border-top: 2px solid #000;
        }
        .ticker-move { display: inline-block; animation: tickerScroll 40s linear infinite; padding-left: 100%; }

        /* NOTIFICATIONS */
        #notif-container { position: fixed; top: 85px; right: 20px; width: 300px; z-index: 5000; pointer-events: none; }
        .notif {
            background: rgba(15, 23, 42, 0.95); border: 1px solid var(--c-blue); color: #fff;
            padding: 12px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: notifIn 0.3s forwards; pointer-events: all; cursor: pointer;
        }
        .notif.danger { border-color: var(--c-red); }
        .notif.success { border-color: var(--c-green); }

        /* Animations */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes modalIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes tickerScroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        @keyframes notifIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes scanline { 0% { top: 0%; } 100% { top: 100%; } }

        .scanline {
            width: 100%; height: 2px; background: rgba(0, 243, 255, 0.1); position: absolute;
            top: 0; left: 0; pointer-events: none; z-index: 2; animation: scanline 8s linear infinite;
        }

        /* Chart Canvas */
        .chart-container { height: 120px; margin-top: 10px; }

    </style>
</head>
<body>

<!-- SOUNDS (OPTIONAL LOGIC) -->
<audio id="sfx-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<!-- TOP HUD -->
<header id="top-hud">
    <div class="hud-logo">AETERNA <span style="color:var(--c-blue); font-size:18px">v10.0</span></div>
    
    <div class="hud-metrics">
        <div class="metric-box" title="Hazine (Milyon $)">
            <span class="change pos" id="delta-money">+$0</span>
            <span class="val" id="val-money" style="color:var(--c-green)">$1,000M</span>
            <span class="lbl">Hazine</span>
        </div>
        <div class="metric-box" title="Politik Güç">
            <span class="val" id="val-pp" style="color:var(--c-gold)">250</span>
            <span class="lbl">Politik G.</span>
        </div>
        <div class="metric-box" title="Nüfus (Milyon)">
            <span class="val" id="val-pop">85.0M</span>
            <span class="lbl">Nüfus</span>
        </div>
        <div class="metric-box" title="Enerji Şebekesi">
            <span class="val" id="val-energy" style="color:var(--c-cyan)">100%</span>
            <span class="lbl">Enerji</span>
        </div>
        <div class="metric-box" title="Küresel Gerilim">
            <span class="val" id="val-tension" style="color:var(--c-red)">5%</span>
            <span class="lbl">Gerilim</span>
        </div>
    </div>

    <div class="defcon-indicator" id="defcon-btn" onclick="game.mil.toggleDefcon()">DEFCON 5</div>

    <div class="time-controls">
        <button class="time-btn" id="t-pause" onclick="game.setSpeed(0)"><i class="fa-solid fa-pause"></i></button>
        <button class="time-btn active" id="t-1x" onclick="game.setSpeed(1)">1x</button>
        <button class="time-btn" id="t-2x" onclick="game.setSpeed(2)">2x</button>
        <button class="time-btn" id="t-5x" onclick="game.setSpeed(4)">5x</button>
    </div>

    <div style="text-align: right; min-width: 120px; border-left: 1px solid #333; padding-left: 15px;">
        <div id="date-display" style="font-family: var(--font-mono); font-weight: bold; font-size: 16px; color: #fff;">2026-01-01</div>
        <div style="font-size: 10px; color: var(--c-grey); font-weight: 700;">TÜRKİYE TEKNOKRASİSİ</div>
    </div>
</header>

<div id="viewport">
    <!-- LEFT PANEL: GOVERNMENT & ECONOMY -->
    <aside class="side-panel">
        <nav class="tab-nav">
            <button class="tab-trigger active" onclick="ui.tab('l', 'eco')">EKONOMİ</button>
            <button class="tab-trigger" onclick="ui.tab('l', 'gov')">DEVLET</button>
            <button class="tab-trigger" onclick="ui.tab('l', 'tech')">AR-GE</button>
        </nav>

        <!-- ECONOMY TAB -->
        <div id="tab-l-eco" class="tab-content active">
            <!-- Strategic Resources -->
            <div class="widget">
                <div class="widget-header">STRATEJİK KAYNAKLAR <span>Stok ve Akış</span></div>
                <div class="res-grid">
                    <div class="res-box" title="Enerji Üretimi"><i class="fa-solid fa-bolt"></i><span class="val" id="r-nrg">0</span><span class="lbl">Güç</span></div>
                    <div class="res-box" title="Ham Petrol"><i class="fa-solid fa-oil-well"></i><span class="val" id="r-oil">0</span><span class="lbl">Petrol</span></div>
                    <div class="res-box" title="Nadir Elementler"><i class="fa-solid fa-microchip"></i><span class="val" id="r-rare">0</span><span class="lbl">Nadir</span></div>
                    <div class="res-box" title="Tarımsal Üretim"><i class="fa-solid fa-wheat-awn"></i><span class="val" id="r-food">0</span><span class="lbl">Gıda</span></div>
                    <div class="res-box" title="Temiz Su"><i class="fa-solid fa-droplet"></i><span class="val" id="r-water">0</span><span class="lbl">Su</span></div>
                    <div class="res-box" title="Çelik & Demir"><i class="fa-solid fa-cubes"></i><span class="val" id="r-steel">0</span><span class="lbl">Çelik</span></div>
                    <div class="res-box" title="Uranyum"><i class="fa-solid fa-radiation"></i><span class="val" id="r-nuke">0</span><span class="lbl">Uran.</span></div>
                    <div class="res-box" title="Mühimmat"><i class="fa-solid fa-box-open"></i><span class="val" id="r-ammo">0</span><span class="lbl">Mühim.</span></div>
                </div>
            </div>

            <!-- Financials -->
            <div class="widget">
                <div class="widget-header">FİNANSAL VERİLER <span>Merkez Bankası</span></div>
                <div class="stat-grid">
                    <div class="stat-item"><span class="val" id="fin-inf">2.4%</span><span class="lbl">Enflasyon</span></div>
                    <div class="stat-item"><span class="val" id="fin-rate">5.0%</span><span class="lbl">Faiz Oranı</span></div>
                    <div class="stat-item"><span class="val" id="fin-debt">$450B</span><span class="lbl">Milli Borç</span></div>
                    <div class="stat-item"><span class="val" id="fin-rating" style="color:var(--c-green)">AAA</span><span class="lbl">Kredi Notu</span></div>
                </div>
                <div style="margin: 10px 0;">
                    <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:5px;">
                        <span>Vergi Oranı: <b id="lbl-tax">20%</b></span>
                        <span id="tax-impact" style="color:var(--c-green)">+120M/Ay</span>
                    </div>
                    <input type="range" min="5" max="60" value="20" style="width:100%; accent-color:var(--c-blue);" oninput="game.eco.setTax(this.value)">
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                    <button class="btn" onclick="game.eco.loan('imf')"><span>IMF Kredisi Al</span><span class="btn-tag">$10B</span></button>
                    <button class="btn" onclick="game.eco.lunder()"><span>Kara Para Akla</span><span class="btn-tag">Riskli</span></button>
                </div>
            </div>

            <!-- Industrial Planning -->
            <div class="widget">
                <div class="widget-header">ENDÜSTRİ VE ALTYAPI <span>Üretim Kapasitesi</span></div>
                <div class="stat-grid">
                    <div class="stat-item"><span class="val" id="ind-civ">12</span><span class="lbl">Sivil Fabrika</span></div>
                    <div class="stat-item"><span class="val" id="ind-mil">4</span><span class="lbl">Askeri Fabrika</span></div>
                </div>
                <button class="btn btn-action" onclick="game.eco.build('civ')"><span>Sivil Fabrika İnşası</span><span class="btn-tag">$500M</span></button>
                <button class="btn btn-action" onclick="game.eco.build('mil')"><span>Askeri Üretim Hattı</span><span class="btn-tag">$800M</span></button>
                <button class="btn btn-action" onclick="game.eco.build('nuc')"><span>Nükleer Enerji Santrali</span><span class="btn-tag">$2.5B</span></button>
                <button class="btn btn-action" onclick="game.eco.build('infra')"><span>Lojistik Altyapı (Yol/Ray)</span><span class="btn-tag">$300M</span></button>
            </div>
        </div>

        <!-- GOVERNMENT TAB -->
        <div id="tab-l-gov" class="tab-content">
             <div class="widget">
                <div class="widget-header">İÇ SİYASET VE STABİLİTE</div>
                <div class="stat-row">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-size:12px;">Halk Memnuniyeti</span>
                        <span id="val-stab" style="color:var(--c-green)">75%</span>
                    </div>
                    <div class="progress-wrapper"><div class="progress-bar" id="bar-stab" style="background:var(--c-green); width:75%"></div></div>
                </div>
                <button class="btn" onclick="game.pol.act('propaganda')">Medya Manipülasyonu (100 PP)</button>
                <button class="btn btn-danger" onclick="game.pol.act('martial')">SIKIYÖNETİM İLAN ET (500 PP)</button>
            </div>
            
            <div class="widget">
                <div class="widget-header">KABİNE ÜYELERİ <span>Danışmanlar</span></div>
                <div id="cabinet-list">
                    <!-- Dynamic -->
                </div>
            </div>
        </div>

        <!-- TECH TAB -->
        <div id="tab-l-tech" class="tab-content">
            <div class="widget">
                <div class="widget-header">AR-GE MERKEZİ <span>Araştırma Puanı: <b id="val-rp">0</b></span></div>
                <button class="btn" onclick="game.tech.res('cyber_shield')">Kuantum Güvenlik Duvarı (1200 RP)</button>
                <button class="btn" onclick="game.tech.res('nano_const')">Nanobot İnşaat Sistemleri (2500 RP)</button>
                <button class="btn" onclick="game.tech.res('thorium')">Toryum Reaktörleri (4000 RP)</button>
                <button class="btn" onclick="game.tech.res('ai_command')">Yapay Zeka Komuta Merkezi (6000 RP)</button>
            </div>
        </div>
    </aside>

    <!-- CENTER AREA: WORLD MAP -->
    <main class="main-canvas-area">
        <div class="scanline"></div>
        <canvas id="world-map"></canvas>
        
        <div id="map-controls">
            <button class="map-mode-btn active" onclick="map.setMode('geo')">POLİTİK HARİTA</button>
            <button class="map-mode-btn" onclick="map.setMode('eco')">EKONOMİK HARİTA</button>
            <button class="map-mode-btn" onclick="map.setMode('mil')">STRATEJİK CEPHELER</button>
            <button class="map-mode-btn" onclick="map.setMode('spy')">İSTİHBARAT AĞI</button>
        </div>

        <div id="province-info">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <h2 id="p-name" style="margin:0; font-family:var(--font-head); font-size:32px; color:var(--c-blue);">ANKARA</h2>
                    <span id="p-owner" style="font-size:11px; color:var(--c-grey); font-weight:bold;">TÜRKİYE TEKNOKRASİSİ</span>
                </div>
                <div id="p-type-icon" style="font-size:24px; color:var(--c-gold);"><i class="fa-solid fa-landmark"></i></div>
            </div>
            <hr style="border:0; border-top:1px solid #333; margin:10px 0;">
            <div class="stat-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="stat-item"><span class="val" id="p-pop">5.5M</span><span class="lbl">Pop.</span></div>
                <div class="stat-item"><span class="val" id="p-inf">8/10</span><span class="lbl">Altyapı</span></div>
                <div class="stat-item"><span class="val" id="p-res">YOK</span><span class="lbl">Kaynak</span></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px;">
                <button class="btn btn-tag" onclick="game.mapAct('invest')">YATIRIM YAP ($50M)</button>
                <button class="btn btn-tag btn-danger" onclick="game.mapAct('covert')">GİZLİ OPERASYON</button>
            </div>
        </div>
    </main>

    <!-- RIGHT PANEL: MILITARY & OPS -->
    <aside class="side-panel">
        <nav class="tab-nav">
            <button class="tab-trigger active" onclick="ui.tab('r', 'mil')">ORDU</button>
            <button class="tab-trigger" onclick="ui.tab('r', 'spy')">CASUSLUK</button>
            <button class="tab-trigger" onclick="ui.tab('r', 'dip')">DİPLOMASİ</button>
        </nav>

        <!-- MILITARY TAB -->
        <div id="tab-r-mil" class="tab-content active">
            <div class="widget">
                <div class="widget-header">ORDU DURUMU <span>Lojistik & Hazırlık</span></div>
                <div class="stat-grid">
                    <div class="stat-item"><span class="val" id="mil-org">100%</span><span class="lbl">Organizasyon</span></div>
                    <div class="stat-item"><span class="val" id="mil-exp">G-1</span><span class="lbl">Tecrübe</span></div>
                </div>
                <div class="progress-wrapper"><div class="progress-bar" id="bar-org" style="background:var(--c-cyan); width:100%"></div></div>
                <div style="font-size:11px; color:var(--c-grey); margin-bottom:5px;">Günlük Gider: <span id="mil-cost" style="color:var(--c-red)">-$12M</span></div>
            </div>

            <div class="widget">
                <div class="widget-header">MOBİLİZASYON <span>Birlik Eğitimi</span></div>
                <button class="btn" onclick="game.mil.train('inf')"><span>Piyade Tümeni</span><span class="btn-tag">$15M</span></button>
                <button class="btn" onclick="game.mil.train('tank')"><span>Zırhlı Tugay</span><span class="btn-tag">$60M</span></button>
                <button class="btn" onclick="game.mil.train('air')"><span>Hava Filosu</span><span class="btn-tag">$150M</span></button>
                <button class="btn" onclick="game.mil.train('drone')"><span>İHA Sürüsü</span><span class="btn-tag">$80M</span></button>
            </div>

            <div class="widget">
                <div class="widget-header">ENVANTER <span>Aktif Kuvvetler</span></div>
                <div id="mil-inv" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; font-size:13px; font-family:var(--font-mono);">
                    <!-- Dynamic -->
                </div>
            </div>
        </div>

        <!-- SPY TAB -->
        <div id="tab-r-spy" class="tab-content">
            <div class="widget">
                <div class="widget-header">İSTİHBARAT SERVİSİ (AİT)</div>
                <div class="stat-grid">
                    <div class="stat-item"><span class="val" id="val-intel">150</span><span class="lbl">Intel Puanı</span></div>
                    <div class="stat-item"><span class="val" id="val-agents">5</span><span class="lbl">Aktif Ajan</span></div>
                </div>
                <button class="btn btn-danger" onclick="game.spy.op('sabotage_ind')">Düşman Sanayisini Sabote Et</button>
                <button class="btn btn-danger" onclick="game.spy.op('cyber_bank')">Borsayı Manipüle Et (Siber)</button>
                <button class="btn btn-danger" onclick="game.spy.op('assassinate')">Siyasi Suikast Girişimi</button>
            </div>
            <div class="widget">
                <div class="widget-header">OPERASYON GÜNLÜĞÜ</div>
                <div id="spy-log" style="height:150px; overflow-y:auto; font-family:var(--font-mono); font-size:10px; color:var(--c-green);">
                    > Sistem çevrimiçi...<br>
                    > Ajanlar sahada...
                </div>
            </div>
        </div>

        <!-- DIPLOMACY TAB -->
        <div id="tab-r-dip" class="tab-content">
            <div class="widget">
                <div class="widget-header">KÜRESEL GÜÇLER <span>İlişkiler</span></div>
                <div id="nation-list">
                    <!-- Dynamic -->
                </div>
            </div>
            <div id="dip-panel" style="display:none;" class="widget">
                <div class="widget-header" id="dip-target-name">HEDEF ÜLKE</div>
                <button class="btn" onclick="game.dip.act('trade')">Ticaret Anlaşması Öner</button>
                <button class="btn" onclick="game.dip.act('sanction')">Ekonomik Ambargo Uygula</button>
                <button class="btn btn-danger" onclick="game.dip.act('war')">SAVAŞ İLAN ET</button>
            </div>
        </div>
    </aside>
</div>

<!-- FOOTER TICKER -->
<footer id="news-ticker">
    <div class="ticker-move" id="ticker-content">
        +++ PİYASALAR AÇILDI +++ PETROL VARİL FİYATI: $82.4 +++ KÜRESEL GERİLİM ARTIYOR +++ YENİ TEKNOLOJİK DEVRİM KAPIDA +++
    </div>
</footer>

<!-- MODALS & NOTIFS -->
<div class="modal-overlay" id="modal-container">
    <div class="modal">
        <div class="modal-head">
            <span id="modal-title">SİSTEM MESAJI</span>
            <i class="fa-solid fa-xmark" style="cursor:pointer" onclick="ui.closeModal()"></i>
        </div>
        <div class="modal-body" id="modal-body">...</div>
        <div class="modal-foot" id="modal-foot">
            <button class="btn" style="width:auto" onclick="ui.closeModal()">ONAYLA</button>
        </div>
    </div>
</div>

<div id="notif-container"></div>

<!-- GAME ENGINE SOURCE -->
<script>
/**
 * AETERNA: OMEGA v10.0 - THE LEVIATHAN ENGINE
 * A High-Fidelity Geopolitical & Economic Simulation
 * Author: Gemini "Warlord" Architect
 */

const CONFIG = {
    tickRate: 1000,
    saveKey: 'aeterna_v10_save',
    version: '10.0.0',
    colors: {
        player: '#00f3ff',
        enemy: '#ff3333',
        ally: '#00ff88',
        neutral: '#64748b',
        unclaimed: '#1a202c'
    },
    // Resource Base Prices (Volatility simulation)
    prices: {
        oil: 80, rare: 120, food: 25, steel: 45, nuke: 500, water: 15
    },
    units: {
        inf: { cost: 15, time: 5, upkeep: 0.1, power: 10, res: { food: 2 } },
        tank: { cost: 60, time: 12, upkeep: 0.8, power: 45, res: { oil: 3, steel: 5 } },
        air: { cost: 150, time: 20, upkeep: 2.5, power: 120, res: { oil: 8, rare: 10 } },
        drone: { cost: 80, time: 10, upkeep: 1.2, power: 65, res: { rare: 15, steel: 2 } }
    }
};

// --- DATA: NATIONS & PROVINCES (The World) ---
const NATIONS = [
    { id: 'tr', name: 'Türkiye', color: '#00f3ff', pp: 250, money: 1000, rel: 100, gdp: 900, ai: false },
    { id: 'us', name: 'ABD', color: '#3b82f6', pp: 800, money: 5000, rel: 45, gdp: 2500, ai: true },
    { id: 'cn', name: 'Çin', color: '#ef4444', pp: 900, money: 4500, rel: 35, gdp: 2200, ai: true },
    { id: 'ru', name: 'Rusya', color: '#f59e0b', pp: 600, money: 2000, rel: 30, gdp: 1200, ai: true },
    { id: 'eu', name: 'Avrupa B.', color: '#10b981', pp: 700, money: 4000, rel: 60, gdp: 2100, ai: true },
    { id: 'ir', name: 'İran', color: '#6366f1', pp: 300, money: 800, rel: 20, gdp: 400, ai: true },
    { id: 'il', name: 'İsrail', color: '#0ea5e9', pp: 400, money: 1200, rel: 15, gdp: 500, ai: true }
];

const PROVINCES = [
    // Türkiye
    { id: 0, n: 'Ankara', x: 580, y: 350, o: 'tr', type: 'cap', pop: 5.8, inf: 9, res: 'none' },
    { id: 1, n: 'İstanbul', x: 530, y: 330, o: 'tr', type: 'city', pop: 15.9, inf: 10, res: 'trade' },
    { id: 2, n: 'İzmir', x: 510, y: 370, o: 'tr', type: 'city', pop: 4.5, inf: 8, res: 'food' },
    { id: 3, n: 'Batman', x: 650, y: 380, o: 'tr', type: 'city', pop: 0.6, inf: 4, res: 'oil' },
    { id: 4, n: 'Eskişehir', x: 550, y: 355, o: 'tr', type: 'city', pop: 0.9, inf: 7, res: 'rare' },
    { id: 5, n: 'Antalya', x: 540, y: 400, o: 'tr', type: 'city', pop: 2.6, inf: 7, res: 'food' },
    // Global Points
    { id: 6, n: 'Moskova', x: 620, y: 150, o: 'ru', type: 'cap', pop: 12.0, inf: 9, res: 'oil' },
    { id: 7, n: 'Washington', x: 180, y: 320, o: 'us', type: 'cap', pop: 7.5, inf: 10, res: 'trade' },
    { id: 8, n: 'Pekin', x: 880, y: 300, o: 'cn', type: 'cap', pop: 21.0, inf: 9, res: 'rare' },
    { id: 9, n: 'Berlin', x: 480, y: 250, o: 'eu', type: 'cap', pop: 3.7, inf: 10, res: 'trade' },
    { id: 10, n: 'Tahran', x: 720, y: 380, o: 'ir', type: 'cap', pop: 9.0, inf: 7, res: 'oil' },
    { id: 11, n: 'Londra', x: 420, y: 230, o: 'eu', type: 'city', pop: 9.5, inf: 10, res: 'trade' },
    { id: 12, n: 'New York', x: 210, y: 300, o: 'us', type: 'city', pop: 8.8, inf: 10, res: 'trade' },
    { id: 13, n: 'Tokyo', x: 950, y: 330, o: 'jp', type: 'cap', pop: 14.0, inf: 10, res: 'rare' },
    { id: 14, n: 'Riyad', x: 680, y: 480, o: 'sa', type: 'cap', pop: 7.0, inf: 8, res: 'oil' }
    // ... 1600+ line logic requires robust data generation ...
];

// --- CORE GAME CLASS ---
class AeternaGame {
    constructor() {
        this.state = {
            date: new Date(2026, 0, 1),
            turn: 0,
            speed: 1,
            paused: false,
            tension: 5,
            
            // Player Economy
            money: 1000,
            debt: 450000, // in Millions
            inflation: 2.4,
            interestRate: 5.0,
            taxRate: 20,
            creditRating: 'AAA',
            pp: 250,
            rp: 0,
            intel: 150,
            
            // Resources
            res: {
                oil: 5000, rare: 500, food: 10000, steel: 2000, 
                nuke: 10, water: 8000, ammo: 1000, energy: 100
            },
            
            // Industry
            factories: { civ: 12, mil: 4, nuc: 1, infra: 5 },
            
            // Military
            units: { inf: 25, tank: 8, air: 3, drone: 5 },
            milQueue: [],
            milOrg: 100,
            
            // Diplomatic state
            diplo: {}, // { nationId: { rel: 50, war: false, trade: false, embargo: false } }
            
            // Domestic
            stab: 75,
            pop: 85.3,
            
            // Logic trackers
            lastTickMoney: 0,
            eventsSeen: []
        };
        
        this.selProv = null;
        this.selNat = null;
        this.timer = null;
        
        // Modules
        this.eco = new EconomyModule(this);
        this.mil = new MilitaryModule(this);
        this.spy = new SpyModule(this);
        this.pol = new PoliticsModule(this);
        this.tech = new TechModule(this);
        this.dip = new DiplomacyModule(this);
    }

    init() {
        console.log("%c AETERNA LEVIATHAN ENGINE v10.0 INITIALIZED ", "background: #00f3ff; color: #000; font-weight: bold;");
        
        // Initialize Diplomacy for all nations
        NATIONS.forEach(n => {
            if(n.id !== 'tr') {
                this.state.diplo[n.id] = { rel: n.rel, war: false, trade: false, embargo: false };
            }
        });

        ui.init(this);
        map.init(this);
        this.setSpeed(1);
        
        // Initial Draw
        ui.update();
    }

    setSpeed(s) {
        this.state.speed = s;
        this.state.paused = (s === 0);
        
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        if(s === 0) document.getElementById('t-pause').classList.add('active');
        else if(s === 1) document.getElementById('t-1x').classList.add('active');
        else if(s === 2) document.getElementById('t-2x').classList.add('active');
        else if(s === 4) document.getElementById('t-5x').classList.add('active');

        clearInterval(this.timer);
        if(!this.state.paused) {
            this.timer = setInterval(() => this.tick(), CONFIG.tickRate / this.state.speed);
        }
    }

    tick() {
        const s = this.state;
        s.turn++;
        s.date.setDate(s.date.getDate() + 1);
        
        // Module Ticks
        this.eco.tick();
        this.mil.tick();
        this.pol.tick();
        this.tech.tick();
        this.spy.tick();
        
        // Dynamic Events
        this.checkEvents();
        
        // UI Sync
        ui.update();
        if(s.turn % 5 === 0) map.draw();
    }

    checkEvents() {
        const s = this.state;
        // Example dynamic event: Economic Crisis
        if(s.inflation > 15 && !s.eventsSeen.includes('hyperinflation')) {
            ui.alert("EKONOMİK KRİZ", "Enflasyon kontrol dışı çıktı! Halk sokaklarda. Stabilite hızla düşüyor.");
            s.stab -= 20;
            s.eventsSeen.push('hyperinflation');
        }
        
        if(Math.random() < 0.005) {
            const news = [
                "Küresel petrol arzında kesinti yaşanıyor.",
                "Teknoloji devlerinden yeni kuantum işlemci duyurusu.",
                "Birleşmiş Milletler gerilimin düşürülmesi çağrısı yaptı.",
                "Borsalarda 'Kara Pazartesi' paniği hakim."
            ];
            ui.pop(news[Math.floor(Math.random()*news.length)], 'gold');
        }
    }

    mapAct(type) {
        if(this.selProv === null) return;
        const p = PROVINCES[this.selProv];
        
        if(type === 'invest') {
            if(this.state.money >= 50) {
                this.state.money -= 50;
                p.inf = Math.min(10, p.inf + 1);
                ui.pop(`${p.n} bölgesine yatırım yapıldı. Altyapı: ${p.inf}/10`, 'green');
            } else ui.pop("Yetersiz fon!", 'red');
        }
    }
}

// --- SUB-MODULE: ECONOMY ---
class EconomyModule {
    constructor(game) { this.game = game; }
    
    tick() {
        const s = this.game.state;
        
        // 1. Resource Production
        let oilYield = 0, foodYield = 0, rareYield = 0, steelYield = 0;
        PROVINCES.forEach(p => {
            if(p.o === 'tr') {
                const multi = 1 + (p.inf * 0.1);
                if(p.res === 'oil') oilYield += 50 * multi;
                if(p.res === 'food') foodYield += 150 * multi;
                if(p.res === 'rare') rareYield += 5 * multi;
                if(p.res === 'steel') steelYield += 20 * multi;
            }
        });
        
        s.res.oil += oilYield; s.res.food += foodYield; s.res.rare += rareYield; s.res.steel += steelYield;
        
        // 2. Industrial Logic (Power)
        const powerNeeded = (s.factories.civ * 5) + (s.factories.mil * 15);
        const powerGen = (s.factories.nuc * 200) + (s.factories.infra * 20);
        s.res.energy = Math.min(100, Math.floor((powerGen / powerNeeded) * 100));
        
        // 3. Money & Taxes
        // GDP Calculation (Simplified)
        const gdp = (s.factories.civ * 120) + (s.pop * 5);
        const dailyTax = (gdp * (s.taxRate/100)) / 30;
        
        // Upkeep
        const milUpkeep = this.game.mil.calcUpkeep();
        const civUpkeep = (s.factories.civ * 2) + (s.factories.nuc * 10);
        
        const netChange = dailyTax - milUpkeep - civUpkeep;
        s.money += netChange;
        s.lastTickMoney = netChange;
        
        // 4. Inflation & Debt
        if(s.money < 0) {
            s.money = 0; s.debt += 100; s.inflation += 0.05;
        }
        
        // Market Volatility
        if(s.turn % 30 === 0) {
            s.inflation += (Math.random() * 0.4) - 0.2;
            if(s.inflation < 1) s.inflation = 1.1;
        }
    }

    setTax(val) {
        this.game.state.taxRate = parseInt(val);
        // Stability impact
        if(val > 35) this.game.state.stab -= 0.05;
        if(val < 15) this.game.state.stab += 0.02;
    }

    build(type) {
        const s = this.game.state;
        const costs = { civ: 500, mil: 800, nuc: 2500, infra: 300 };
        if(s.money >= costs[type]) {
            s.money -= costs[type];
            s.factories[type]++;
            ui.pop(`${type.toUpperCase()} inşası tamamlandı.`, 'green');
        } else ui.pop("Yetersiz Hazine!", 'red');
    }

    loan(provider) {
        this.game.state.money += 10000;
        this.game.state.debt += 12000; // 20% interest
        ui.alert("IMF ANLAŞMASI", "10 Milyar $ hazineye aktarıldı. Borç yükü arttı.");
    }
    
    lunder() {
        const s = this.game.state;
        if(Math.random() > 0.3) {
            s.money += 500; s.intel -= 20; ui.pop("Operasyon başarılı: +$500M", 'green');
        } else {
            s.stab -= 10; s.creditRating = 'BBB'; ui.alert("SKANDAL", "Para aklama ağı deşifre oldu! Uluslararası itibar zedelendi.");
        }
    }
}

// --- SUB-MODULE: MILITARY ---
class MilitaryModule {
    constructor(game) { this.game = game; }

    tick() {
        const s = this.game.state;
        // Progress training queue
        for(let i = s.milQueue.length-1; i >= 0; i--) {
            s.milQueue[i].time--;
            if(s.milQueue[i].time <= 0) {
                s.units[s.milQueue[i].type]++;
                s.milQueue.splice(i, 1);
                ui.pop("Yeni birlik göreve hazır.", 'cyan');
            }
        }
        
        // Org recovery
        if(s.res.energy < 50) s.milOrg -= 0.5;
        else if(s.milOrg < 100) s.milOrg += 0.2;
    }

    calcUpkeep() {
        const s = this.game.state;
        let total = 0;
        for(let key in s.units) {
            total += s.units[key] * CONFIG.units[key].upkeep;
        }
        return total;
    }

    train(type) {
        const s = this.game.state;
        const u = CONFIG.units[type];
        if(s.money >= u.cost) {
            s.money -= u.cost;
            s.milQueue.push({ type: type, time: u.time });
            ui.pop(`${type.toUpperCase()} üretimi başladı.`);
        } else ui.pop("Yetersiz para!", 'red');
    }

    toggleDefcon() {
        let current = this.game.state.tension > 50 ? 2 : 5;
        const d = this.game.state;
        // Manual toggle logic
        let next = 5;
        if(d.tension < 20) next = 5;
        else if(d.tension < 40) next = 4;
        else if(d.tension < 60) next = 3;
        else next = 1;

        ui.alert("SAVAŞ DURUMU", `DEFCON seviyesi ${next} olarak güncellendi.`);
    }
}

// --- SUB-MODULE: SPY ---
class SpyModule {
    constructor(game) { this.game = game; }
    tick() { this.game.state.intel += 0.5; }
    op(type) {
        const s = this.game.state;
        if(s.intel >= 100) {
            s.intel -= 100;
            if(Math.random() > 0.4) {
                ui.alert("OPERASYON BAŞARILI", "Hedef sistemler siber saldırı ile felç edildi.");
                ui.log("Düşman bankacılık verileri ele geçirildi.", 'green');
                s.money += 200;
            } else {
                ui.alert("OPERASYON DEŞİFRE OLDU", "Ajanlarımız yakalandı!", 'red');
                s.pp -= 50; s.tension += 5;
            }
        } else ui.pop("Yetersiz Intel!", 'red');
    }
}

// --- SUB-MODULES: POLITICS, TECH, DIP ---
class PoliticsModule {
    constructor(game) { this.game = game; }
    tick() { this.game.state.pp += 0.2; }
    act(type) {
        const s = this.game.state;
        if(type === 'propaganda' && s.pp >= 100) {
            s.pp -= 100; s.stab = Math.min(100, s.stab + 10); ui.pop("Halk desteği artıyor.");
        } else if(type === 'martial' && s.pp >= 500) {
            s.pp -= 500; s.stab = 100; s.taxRate = 50; ui.alert("SIKIYÖNETİM", "Demokrasi askıya alındı. Devlet kontrolü tam.");
        }
    }
}

class TechModule {
    constructor(game) { this.game = game; }
    tick() { this.game.state.rp += (this.game.state.factories.civ * 0.1); }
    res(type) {
        const s = this.game.state;
        const costs = { cyber_shield: 1200, nano_const: 2500, thorium: 4000, ai_command: 6000 };
        if(s.rp >= costs[type]) {
            s.rp -= costs[type];
            ui.alert("TEKNOLOJİ GELİŞTİRİLDİ", `${type.replace('_',' ').toUpperCase()} artık aktif.`);
            if(type === 'thorium') s.factories.nuc += 2;
        } else ui.pop("Yetersiz RP!", 'red');
    }
}

class DiplomacyModule {
    constructor(game) { this.game = game; }
    act(type) {
        const target = this.game.selNat;
        if(!target) return;
        const d = this.game.state.diplo[target.id];
        
        if(type === 'trade') {
            if(d.rel > 40) { d.trade = true; d.rel += 5; ui.pop("Ticaret rotaları açıldı."); }
            else ui.pop("Teklif reddedildi.", 'red');
        } else if(type === 'war') {
            d.war = true; d.rel = 0; this.game.state.tension += 20;
            ui.alert("SAVAŞ İLANI", `${target.name} ile resmen savaştayız!`);
        }
    }
}

// --- UI ENGINE ---
const ui = {
    game: null,
    init(g) {
        this.game = g;
        this.renderNations();
        this.renderCabinet();
        this.update();
    },

    update() {
        const s = this.game.state;
        
        // HUD
        document.getElementById('val-money').innerText = '$' + Math.floor(s.money).toLocaleString() + 'M';
        document.getElementById('delta-money').innerText = (s.lastTickMoney >= 0 ? '+' : '') + Math.floor(s.lastTickMoney) + 'M';
        document.getElementById('delta-money').className = 'change ' + (s.lastTickMoney >= 0 ? 'pos' : 'neg');
        
        document.getElementById('val-pp').innerText = Math.floor(s.pp);
        document.getElementById('val-energy').innerText = s.res.energy + '%';
        document.getElementById('val-tension').innerText = s.tension + '%';
        document.getElementById('date-display').innerText = s.date.toISOString().split('T')[0];
        
        // Resources
        document.getElementById('r-nrg').innerText = s.res.energy;
        document.getElementById('r-oil').innerText = Math.floor(s.res.oil);
        document.getElementById('r-food').innerText = Math.floor(s.res.food);
        document.getElementById('r-rare').innerText = Math.floor(s.res.rare);
        document.getElementById('r-steel').innerText = Math.floor(s.res.steel);
        document.getElementById('r-nuke').innerText = s.res.nuke;
        document.getElementById('r-ammo').innerText = s.res.ammo;
        
        // Financials
        document.getElementById('fin-inf').innerText = s.inflation.toFixed(1) + '%';
        document.getElementById('fin-rate').innerText = s.interestRate.toFixed(1) + '%';
        document.getElementById('fin-debt').innerText = '$' + (s.debt / 1000).toFixed(1) + 'B';
        document.getElementById('fin-rating').innerText = s.creditRating;
        document.getElementById('lbl-tax').innerText = s.taxRate + '%';
        
        // Industry
        document.getElementById('ind-civ').innerText = s.factories.civ;
        document.getElementById('ind-mil').innerText = s.factories.mil;
        
        // Stability
        document.getElementById('val-stab').innerText = Math.floor(s.stab) + '%';
        document.getElementById('bar-stab').style.width = s.stab + '%';
        
        // Military
        document.getElementById('mil-org').innerText = Math.floor(s.milOrg) + '%';
        document.getElementById('bar-org').style.width = s.milOrg + '%';
        document.getElementById('mil-cost').innerText = '-$' + Math.floor(this.game.mil.calcUpkeep()) + 'M';
        
        // Inventory
        const inv = document.getElementById('mil-inv');
        inv.innerHTML = '';
        for(let k in s.units) {
            inv.innerHTML += `<div>${k.toUpperCase()}: ${s.units[k]}</div>`;
        }

        // Tech
        document.getElementById('val-rp').innerText = Math.floor(s.rp);
    },

    tab(side, id) {
        const container = (side === 'l') ? document.querySelector('.side-panel:first-child') : document.querySelector('.side-panel:last-child');
        container.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        container.querySelectorAll('.tab-trigger').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`tab-${side}-${id}`).classList.add('active');
        event.currentTarget.classList.add('active');
    },

    renderNations() {
        const list = document.getElementById('nation-list');
        list.innerHTML = '';
        NATIONS.forEach(n => {
            if(n.id === 'tr') return;
            const dip = this.game.state.diplo[n.id];
            const div = document.createElement('div');
            div.className = 'btn';
            div.style.borderLeft = `3px solid ${n.color}`;
            div.innerHTML = `<span>${n.name}</span> <span class="btn-tag">${dip.rel}</span>`;
            div.onclick = () => {
                this.game.selNat = n;
                document.getElementById('dip-panel').style.display = 'block';
                document.getElementById('dip-target-name').innerText = n.name.toUpperCase();
            };
            list.appendChild(div);
        });
    },

    renderCabinet() {
        const list = document.getElementById('cabinet-list');
        const roles = [
            { r: 'Maliye Bakanı', n: 'Caner Aksoy', b: 'Vergi +%5' },
            { r: 'Genelkurmay B.', n: 'Gen. Demir', b: 'Org +%10' },
            { r: 'İstihbarat B.', n: 'Leyla S.', b: 'Intel +2' }
        ];
        list.innerHTML = '';
        roles.forEach(c => {
            list.innerHTML += `<div class="btn"><div><b>${c.r}</b><br><small>${c.n}</small></div><span class="btn-tag">${c.b}</span></div>`;
        });
    },

    pop(msg, color='blue') {
        const ticker = document.getElementById('ticker-content');
        ticker.innerHTML = ` +++ <span style="color:var(--c-${color})">${msg.toUpperCase()}</span>` + ticker.innerHTML;
        this.notify(msg, color==='red'?'danger':'info');
    },

    notify(msg, type='info') {
        const container = document.getElementById('notif-container');
        const n = document.createElement('div');
        n.className = 'notif ' + type;
        n.innerHTML = msg;
        container.prepend(n);
        setTimeout(() => n.remove(), 5000);
    },

    alert(title, body) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body').innerText = body;
        document.getElementById('modal-container').style.display = 'flex';
    },

    closeModal() { document.getElementById('modal-container').style.display = 'none'; },
    
    log(msg, color) {
        const log = document.getElementById('spy-log');
        log.innerHTML = `<span style="color:${color}">> ${msg}</span><br>` + log.innerHTML;
    }
};

// --- MAP ENGINE (CANVAS BASED) ---
const map = {
    game: null, cvs: null, ctx: null, mode: 'geo',
    init(g) {
        this.game = g;
        this.cvs = document.getElementById('world-map');
        this.ctx = this.cvs.getContext('2d');
        window.addEventListener('resize', () => this.resize());
        this.resize();
        this.cvs.addEventListener('mousedown', (e) => this.handleClick(e));
        this.animate();
    },
    resize() {
        const parent = this.cvs.parentElement;
        this.cvs.width = parent.offsetWidth;
        this.cvs.height = parent.offsetHeight;
        this.draw();
    },
    setMode(m) {
        this.mode = m;
        document.querySelectorAll('.map-mode-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        this.draw();
    },
    draw() {
        const ctx = this.ctx;
        ctx.clearRect(0, 0, this.cvs.width, this.cvs.height);
        
        // Draw Connections
        ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.lineWidth = 1;
        PROVINCES.forEach((p1, i) => {
            PROVINCES.forEach((p2, j) => {
                if(i < j && Math.hypot(p1.x - p2.x, p1.y - p2.y) < 250) {
                    ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                }
            });
        });

        // Draw Provinces
        PROVINCES.forEach((p, i) => {
            let color = '#1e293b';
            if(this.mode === 'geo') {
                if(p.o === 'tr') color = CONFIG.colors.player;
                else {
                    const n = NATIONS.find(x => x.id === p.o);
                    color = n ? n.color : '#444';
                    if(this.game.state.diplo[p.o]?.war) color = CONFIG.colors.enemy;
                }
            } else if(this.mode === 'eco') {
                if(p.res === 'oil') color = '#fbbf24';
                else if(p.res === 'rare') color = '#bc13fe';
                else if(p.res === 'food') color = '#10b981';
                else color = '#334155';
            } else if(this.mode === 'mil') {
                color = p.o === 'tr' ? '#00f3ff' : '#ff3333';
                ctx.globalAlpha = p.inf / 10;
            }

            // Outer Glow
            if(this.game.selProv === i) {
                ctx.shadowBlur = 15; ctx.shadowColor = '#fff';
            } else {
                ctx.shadowBlur = 0;
            }

            ctx.fillStyle = color;
            ctx.beginPath(); ctx.arc(p.x, p.y, (p.type==='cap'?8:5), 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1.0; ctx.shadowBlur = 0;

            // Labels
            ctx.fillStyle = '#fff'; ctx.font = '10px Rajdhani'; ctx.textAlign = 'center';
            ctx.fillText(p.n.toUpperCase(), p.x, p.y - 12);
        });
    },
    handleClick(e) {
        const rect = this.cvs.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        
        let hit = null;
        PROVINCES.forEach((p, i) => {
            if(Math.hypot(mx - p.x, my - p.y) < 15) hit = i;
        });

        if(hit !== null) {
            this.game.selProv = hit;
            const p = PROVINCES[hit];
            const uiP = document.getElementById('province-info');
            uiP.style.display = 'block';
            document.getElementById('p-name').innerText = p.n.toUpperCase();
            document.getElementById('p-pop').innerText = p.pop + 'M';
            document.getElementById('p-inf').innerText = p.inf + '/10';
            document.getElementById('p-res').innerText = p.res.toUpperCase();
            document.getElementById('p-owner').innerText = p.o === 'tr' ? 'TÜRKİYE TEKNOKRASİSİ' : p.o.toUpperCase();
            this.draw();
        } else {
            this.game.selProv = null;
            document.getElementById('province-info').style.display = 'none';
            this.draw();
        }
    },
    animate() {
        // Subtle map animations if needed
        requestAnimationFrame(() => this.animate());
    }
};

// Start Global Instance
const game = new AeternaGame();
window.onload = () => game.init();

</script>
</body>
</html>
