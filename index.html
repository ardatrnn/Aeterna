<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AETERNA OS v11.0 | GLOBAL ECONOMY</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;600;800&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="https://ardatrnn.github.io/Aeterna/manifest.json">
    <style>
        :root {
            --gold: #c5a059;
            --gold-light: #e2c999;
            --bg-deep: #050505;
            --panel-bg: rgba(15, 15, 20, 0.98);
            --border-ui: 1px solid rgba(197, 160, 89, 0.3);
            --danger: #ff4d4d;
            --success: #2ecc71;
            --info: #3498db;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-deep);
            color: #d1d5db;
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- TOP BAR --- */
        #top-bar {
            height: auto;
            min-height: 60px;
            background: #000;
            border-bottom: 2px solid var(--gold);
            display: flex;
            align-items: center;
            padding: 5px 15px;
            gap: 10px;
            z-index: 1000;
            overflow-x: auto;
            white-space: nowrap;
        }

        .res-pill { 
            display: flex; align-items: center; gap: 6px; 
            background: rgba(255,255,255,0.05); padding: 5px 10px; 
            border-radius: 4px; border: 1px solid rgba(255,255,255,0.1);
            font-size: 0.75rem;
        }
        .res-pill span { font-weight: 800; color: #fff; }
        .res-pill i { color: var(--gold); font-style: normal; font-size: 0.6rem; font-weight: bold; }

        /* --- MAIN LAYOUT --- */
        #main-layout {
            flex: 1;
            display: grid;
            grid-template-columns: 320px 1fr 350px;
            gap: 10px;
            padding: 10px;
            overflow: hidden;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
        }

        @media (max-width: 1200px) {
            #main-layout { grid-template-columns: 1fr; overflow-y: auto; display: block; }
            .column { height: auto !important; margin-bottom: 10px; }
            #map-area { height: 350px !important; }
            #chart-container { height: 250px !important; }
        }

        .column { display: flex; flex-direction: column; gap: 10px; overflow: hidden; height: 100%; }

        /* --- WIDGETS --- */
        .widget {
            background: var(--panel-bg);
            border: var(--border-ui);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }
        .widget-h {
            padding: 10px 15px;
            background: rgba(197, 160, 89, 0.15);
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--gold-light);
            border-bottom: var(--border-ui);
            display: flex; justify-content: space-between; align-items: center;
        }
        .widget-b { padding: 12px; flex: 1; overflow-y: auto; }

        /* --- CHART & MAP --- */
        #chart-container { height: 180px; width: 100%; }
        #map-area { flex: 1; background: #000; position: relative; min-height: 300px; border-radius: 4px; overflow: hidden; }
        #map-canvas { width: 100%; height: 100%; touch-action: none; }

        /* --- ACTION ITEMS --- */
        .action-btn {
            width: 100%; padding: 10px; background: #111; border: 1px solid #333;
            color: #ddd; cursor: pointer; margin-bottom: 5px; border-radius: 4px;
            font-size: 0.7rem; text-align: left; transition: 0.2s;
        }
        .action-btn:hover { border-color: var(--gold); background: #1a1a1a; }
        .action-btn:active { background: var(--gold); color: #000; }

        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #222; font-size: 0.75rem; }
        .stat-val { font-weight: bold; color: #fff; }

        /* --- LOGS --- */
        #log-feed { font-family: 'Fira Code', monospace; font-size: 0.65rem; color: #888; }
        .log-entry { margin-bottom: 4px; border-left: 2px solid #444; padding-left: 5px; }
        .log-entry.crit { color: var(--danger); border-color: var(--danger); }
        .log-entry.success { color: var(--success); border-color: var(--success); }

        /* --- MODAL --- */
        #global-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center; z-index: 5000;
        }
        .modal-box {
            width: 90%; max-width: 450px; background: #111; border: 2px solid var(--gold);
            padding: 20px; border-radius: 4px;
        }

        #news-ticker {
            height: 30px; background: var(--gold); color: #000;
            display: flex; align-items: center; font-size: 0.7rem; font-weight: 800;
            overflow: hidden; white-space: nowrap;
        }
        .ticker-text { display: inline-block; animation: scroll 30s linear infinite; }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
    </style>
</head>
<body>

<div id="top-bar">
    <div style="font-family:'Cinzel'; color:var(--gold); font-size:1rem; padding-right:10px;">AETERNA.v11</div>
    <div class="res-pill"><i>$</i> <span id="ui-money">1.2M</span></div>
    <div class="res-pill"><i>KUR</i> <span id="ui-fx">1.00</span></div>
    <div class="res-pill"><i>ENF</i> <span id="ui-inf">2.0%</span></div>
    <div class="res-pill"><i>FE</i> <span id="ui-steel">450</span></div>
    <div class="res-pill"><i>STB</i> <span id="ui-stb">92%</span></div>
    <div id="game-date" style="margin-left:auto; color:var(--gold-light); font-weight: bold; font-size: 0.7rem;">1 OCAK 1936</div>
</div>

<div id="news-ticker">
    <div class="ticker-text" id="ticker-content">PIYASALAR ACILDI... MERKEZ BANKASI VERILERI BEKLENIYOR... ENFLASYON HEDEFI %2...</div>
</div>

<main id="main-layout">
    <!-- SOL KOLON: EKONOMI VE NUFUZ -->
    <div class="column">
        <div class="widget">
            <div class="widget-h">EKONOMIK GÖSTERGELER</div>
            <div class="widget-b">
                <div id="chart-container"><canvas id="econChart"></canvas></div>
                <div class="stat-row"><span>Politika Faizi:</span> <span class="stat-val" id="ui-rate">5.0%</span></div>
                <div class="stat-row"><span>Bütçe Dengesi:</span> <span class="stat-val" id="ui-budget">+12K</span></div>
                <div style="margin-top:10px; display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                    <button class="action-btn" onclick="game.adjustRate(0.5)">Faiz Arttır</button>
                    <button class="action-btn" onclick="game.adjustRate(-0.5)">Faiz Düşür</button>
                </div>
            </div>
        </div>

        <div class="widget" style="flex:1">
            <div class="widget-h">TOPLUMSAL YAPI</div>
            <div class="widget-b">
                <div class="stat-row"><span>İşsizlik Oranı:</span> <span class="stat-val" id="ui-unemp">4.5%</span></div>
                <div class="stat-row"><span>Halk Memnuniyeti:</span> <span class="stat-val" id="ui-pop-stb">88%</span></div>
                <div style="margin-top:10px;">
                    <button class="action-btn" onclick="game.enact('welfare')">Sosyal Yardım Dağıt (-$)</button>
                    <button class="action-btn" onclick="game.enact('job_program')">İstihdam Paketi (-$)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ORTA KOLON: STRATEJI HARITASI -->
    <div class="column">
        <div id="map-area" class="widget">
            <div class="widget-h">STRATEJIK HARITA <span id="map-mode">POLITIK</span></div>
            <canvas id="map-canvas"></canvas>
            <div style="position:absolute; bottom:10px; left:10px; display:flex; gap:5px;">
                <button class="action-btn" style="width:auto; background:rgba(0,0,0,0.8)" onclick="game.setMapMode('political')">Siyasi</button>
                <button class="action-btn" style="width:auto; background:rgba(0,0,0,0.8)" onclick="game.setMapMode('economic')">Ekonomik</button>
            </div>
        </div>
        <div class="widget" style="height:120px;">
            <div class="widget-h">INŞAAT VE SANAYI</div>
            <div class="widget-b" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px;">
                <button class="action-btn" onclick="game.build('steel')">Çelik Fab.</button>
                <button class="action-btn" onclick="game.build('energy')">Santral</button>
                <button class="action-btn" onclick="game.build('infra')">Altyapı</button>
            </div>
        </div>
    </div>

    <!-- SAĞ KOLON: RAPORLAR VE GÜNLÜK -->
    <div class="column">
        <div class="widget">
            <div class="widget-h">DIŞ POLITIKA VE REFORMLAR</div>
            <div class="widget-b">
                <button class="action-btn" onclick="game.enact('export')">İhracat Teşviği (+Kur Duyarlı)</button>
                <button class="action-btn" onclick="game.enact('import_tax')">İthalat Vergisi (-Kur Etkisi)</button>
                <button class="action-btn" onclick="game.enact('print_money')">Para Bas (!! Enflasyon !!)</button>
            </div>
        </div>

        <div class="widget" style="flex:1">
            <div class="widget-h">SISTEM GÜNLÜĞÜ</div>
            <div class="widget-b" id="log-feed">
                <div class="log-entry">> Aeterna OS v11.0 Hazır...</div>
            </div>
        </div>
    </div>
</main>

<div id="global-overlay">
    <div class="modal-box">
        <h2 id="modal-title" style="font-family:'Cinzel'; color:var(--gold); margin:0 0 10px 0;"></h2>
        <p id="modal-content" style="font-size:0.85rem; line-height:1.5; color:#bbb;"></p>
        <div id="modal-options"></div>
    </div>
</div>

<script>
    // --- EKONOMIK MODEL VE OYUN MANTIGI ---
    const game = {
        state: {
            money: 1200000,
            fx: 1.00,
            inflation: 2.0,
            rate: 5.0,
            unemployment: 4.5,
            stability: 92,
            steel: 450,
            date: new Date(1936, 0, 1),
            factories: 4,
            history: { inf: [2.0], fx: [1.00], un: [4.5], labels: ['Oca'] }
        },

        chart: null,

        init() {
            this.initChart();
            this.initMap();
            this.startLoop();
            this.log("Protokol başlatıldı: Ekonomik stabilite aranıyor.", "success");
            this.updateUI();
        },

        initChart() {
            const ctx = document.getElementById('econChart').getContext('2d');
            this.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: this.state.history.labels,
                    datasets: [
                        { label: 'Enfl.', data: this.state.history.inf, borderColor: '#ff4d4d', borderWidth: 2, tension: 0.3, pointRadius: 0 },
                        { label: 'Kur', data: this.state.history.fx, borderColor: '#2ecc71', borderWidth: 2, tension: 0.3, pointRadius: 0 }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { grid: { color: '#222' } }, x: { display: false } }
                }
            });
        },

        initMap() {
            const canvas = document.getElementById('map-canvas');
            const ctx = canvas.getContext('2d');
            const resize = () => {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                this.drawMap(ctx);
            };
            window.addEventListener('resize', resize);
            resize();
        },

        drawMap(ctx) {
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            ctx.clearRect(0, 0, w, h);
            ctx.strokeStyle = 'rgba(197, 160, 89, 0.1)';
            for(let i=0; i<w; i+=30) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,h); ctx.stroke(); }
            
            // Örnek Ülke Sınırı
            ctx.beginPath();
            ctx.moveTo(w*0.2, h*0.3); ctx.lineTo(w*0.6, h*0.2); ctx.lineTo(w*0.7, h*0.6); ctx.lineTo(w*0.3, h*0.7);
            ctx.closePath();
            ctx.fillStyle = this.state.stability > 50 ? 'rgba(46, 204, 113, 0.2)' : 'rgba(231, 76, 60, 0.2)';
            ctx.fill();
            ctx.strokeStyle = varColor('--gold');
            ctx.stroke();
        },

        startLoop() {
            setInterval(() => this.tick(), 5000);
        },

        tick() {
            // Tarih ilerletme
            this.state.date.setMonth(this.state.date.getMonth() + 1);

            // Ekonomi Simulasyonu
            // 1. Faiz-Enflasyon ilişkisi: Faiz düşükse enflasyon artar
            const targetInf = (10 - this.state.rate) * 1.5;
            this.state.inflation += (targetInf - this.state.inflation) * 0.1;

            // 2. Kur Etkisi: Enflasyon yükseldikçe kur artar
            this.state.fx += (this.state.inflation / 20) * Math.random();

            // 3. Gelir Gider
            const revenue = (this.state.factories * 50000) / this.state.fx;
            const expense = 30000 + (this.state.inflation * 1000);
            this.state.money += (revenue - expense);

            // 4. Stabilite: Enflasyon %10 üstündeyse düşer
            if(this.state.inflation > 10) this.state.stability -= 1;
            else if(this.state.inflation < 5) this.state.stability = Math.min(100, this.state.stability + 1);

            // Geçmiş verileri güncelle
            this.state.history.inf.push(this.state.inflation.toFixed(1));
            this.state.history.fx.push(this.state.fx.toFixed(2));
            if(this.state.history.inf.length > 15) {
                this.state.history.inf.shift();
                this.state.history.fx.shift();
            }

            this.updateUI();
            if(Math.random() > 0.9) this.triggerEvent();
        },

        updateUI() {
            document.getElementById('ui-money').innerText = (this.state.money / 1000000).toFixed(2) + "M";
            document.getElementById('ui-fx').innerText = this.state.fx.toFixed(2);
            document.getElementById('ui-inf').innerText = this.state.inflation.toFixed(1) + "%";
            document.getElementById('ui-rate').innerText = this.state.rate.toFixed(1) + "%";
            document.getElementById('ui-stb').innerText = this.state.stability + "%";
            document.getElementById('ui-unemp').innerText = this.state.unemployment.toFixed(1) + "%";

            const months = ["Oca","Sub","Mar","Nis","May","Haz","Tem","Agu","Eyl","Eki","Kas","Ara"];
            document.getElementById('game-date').innerText = `1 ${months[this.state.date.getMonth()]} ${this.state.date.getFullYear()}`;

            if(this.chart) this.chart.update();
        },

        adjustRate(val) {
            this.state.rate = Math.max(0, this.state.rate + val);
            this.log(`Faiz oranı %${this.state.rate.toFixed(1)} seviyesine çekildi.`);
            this.updateUI();
        },

        enact(type) {
            if(type === 'print_money') {
                this.state.money += 500000;
                this.state.inflation += 5;
                this.state.fx += 0.5;
                this.log("Karşılıksız para basıldı! Enflasyon fırladı.", "crit");
            } else if(type === 'welfare') {
                if(this.state.money > 100000) {
                    this.state.money -= 100000;
                    this.state.stability += 5;
                    this.log("Halk yardımları dağıtıldı.");
                }
            }
            this.updateUI();
        },

        build(type) {
            const cost = 250000 * this.state.fx;
            if(this.state.money >= cost) {
                this.state.money -= cost;
                this.state.factories++;
                this.log(`Yeni tesis inşa edildi. Maliyet: $${cost.toFixed(0)}`, "success");
            } else {
                this.log("Yetersiz döviz/fon!", "crit");
            }
            this.updateUI();
        },

        log(msg, type="") {
            const f = document.getElementById('log-feed');
            const d = document.createElement('div');
            d.className = `log-entry ${type}`;
            d.innerText = `> ${msg}`;
            f.prepend(d);
            if(f.childNodes.length > 10) f.lastChild.remove();
        },

        triggerEvent() {
            const evs = [
                { t: "BORSA ÇÖKÜŞÜ", d: "Küresel piyasalarda yaşanan panik yerel kuru vurdu.", f: () => { this.state.fx += 0.4; this.state.stability -= 10; } },
                { t: "TEKNOLOJIK ATILIM", d: "Sanayide verimlilik arttı.", f: () => { this.state.factories += 1; } }
            ];
            const e = evs[Math.floor(Math.random() * evs.length)];
            
            document.getElementById('modal-title').innerText = e.t;
            document.getElementById('modal-content').innerText = e.d;
            document.getElementById('modal-options').innerHTML = `<button class="btn-prime" style="width:100%; padding:10px; background:var(--gold); border:none; color:#000; font-weight:bold;" onclick="document.getElementById('global-overlay').style.display='none'">ANLAŞILDI</button>`;
            e.f();
            document.getElementById('global-overlay').style.display = 'flex';
        },

        setMapMode(m) {
            this.log(`Harita modu: ${m}`);
            document.getElementById('map-mode').innerText = m.toUpperCase();
        }
    };

    function varColor(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    window.onload = () => game.init();

    // SERVICE WORKER KAYDI (SİLİNMEDİ)
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./sw.js").then(() => console.log("SW Aktif")).catch(err => console.log("SW Hata", err));
    }
</script>
</body>
</html>
