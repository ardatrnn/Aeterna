<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AETERNA: OMEGA v7.0 | GRAND STRATEGY & GEOPOLITICS SIMULATOR</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Teko:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- VISUAL CORE (CYBER-COMMAND STYLE) --- */
        :root {
            --bg-deep: #030405;
            --bg-panel: #0a0e14;
            --bg-header: #11161d;
            --overlay: rgba(10, 14, 20, 0.95);
            
            --c-blue: #00f3ff;
            --c-gold: #ffd700;
            --c-red: #ff2a2a;
            --c-green: #0aff0a;
            --c-purple: #9d00ff;
            --c-orange: #ff9100;
            --c-grey: #5c6370;
            
            --border: 1px solid rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 0 10px rgba(0, 243, 255, 0.2);
            --font-head: 'Teko', sans-serif;
            --font-ui: 'Rajdhani', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background-color: var(--bg-deep);
            color: #dcdfe4;
            font-family: var(--font-ui);
            margin: 0; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
            background-image: radial-gradient(circle at 50% 50%, #151b24 0%, #000 130%);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--c-blue); }

        /* --- TOP HUD --- */
        #top-hud {
            height: 60px; background: var(--bg-header); border-bottom: var(--border);
            display: flex; align-items: center; padding: 0 20px; gap: 20px;
            box-shadow: 0 5px 20px #000; z-index: 100;
        }

        .hud-logo { 
            font-family: var(--font-head); font-size: 32px; color: #fff; 
            letter-spacing: 2px; margin-right: 10px; 
            text-shadow: 0 0 15px var(--c-blue);
        }

        .metric-group { display: flex; gap: 15px; border-right: 1px solid #333; padding-right: 15px; height: 40px; align-items: center; }
        
        .metric { display: flex; flex-direction: column; min-width: 70px; cursor: help; position: relative; }
        .metric-val { font-family: var(--font-mono); font-weight: 700; color: #fff; font-size: 15px; line-height: 1; }
        .metric-lbl { font-size: 10px; color: var(--c-grey); font-weight: 600; text-transform: uppercase; margin-top: 3px; }
        .metric-icon { margin-right: 4px; color: var(--c-blue); font-size: 10px; }
        
        .defcon-panel {
            font-family: var(--font-head); font-size: 24px; padding: 2px 20px;
            border: 2px solid var(--c-red); color: var(--c-red); background: rgba(50,0,0,0.4);
            text-shadow: 0 0 10px var(--c-red); border-radius: 4px; cursor: pointer;
            transition: 0.3s; animation: pulse 3s infinite;
        }
        .defcon-panel:hover { background: var(--c-red); color: #000; }

        .date-display { text-align: right; font-family: var(--font-mono); }
        .date-main { color: var(--c-gold); font-size: 16px; font-weight: bold; }
        
        /* --- MAIN LAYOUT --- */
        #viewport {
            flex: 1; display: grid; 
            grid-template-columns: 360px 1fr 360px;
            overflow: hidden; gap: 1px; background: #222;
        }

        .panel { background: var(--bg-panel); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        /* TABS */
        .tabs { display: flex; background: #05070a; border-bottom: var(--border); overflow-x: auto; }
        .tab-btn {
            flex: 1; background: transparent; border: none; color: #888; min-width: 60px;
            font-family: var(--font-head); font-size: 18px; height: 45px;
            cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent;
        }
        .tab-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab-btn.active { color: var(--c-blue); border-bottom-color: var(--c-blue); background: rgba(0, 243, 255, 0.05); }

        .content-area { padding: 10px; overflow-y: auto; flex: 1; display: none; }
        .content-area.active { display: block; animation: fadeIn 0.3s ease-out; }

        /* CARDS & WIDGETS */
        .card { 
            background: rgba(255,255,255,0.02); border: var(--border); 
            padding: 12px; margin-bottom: 10px; border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .card-header { 
            font-size: 12px; font-weight: 700; color: var(--c-gold); 
            margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;
            display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding-bottom: 5px;
        }

        .stat-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; align-items: center; }
        .stat-val { font-family: var(--font-mono); color: #fff; }

        .progress-bar { height: 6px; background: #1a1f26; border-radius: 3px; overflow: hidden; margin: 4px 0 8px 0; }
        .progress-fill { height: 100%; transition: width 0.5s; }

        /* BUTTONS */
        .btn {
            width: 100%; padding: 8px 12px; background: linear-gradient(90deg, #151a21, #1e242e);
            border: 1px solid #333; color: #ccc; text-align: left;
            font-family: var(--font-ui); font-size: 14px; cursor: pointer; border-radius: 4px;
            margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .btn::after { content:''; position: absolute; left:0; bottom:0; height:2px; width:0%; background: var(--c-blue); transition: width 0.3s; }
        .btn:hover:not(:disabled) { border-color: var(--c-blue); color: #fff; background: #232b36; }
        .btn:hover::after { width: 100%; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        
        .btn-danger { border-left: 3px solid var(--c-red); }
        .btn-danger:hover { border-color: var(--c-red); background: rgba(50,10,10,0.5); }
        
        .btn-tag { font-size: 10px; font-family: var(--font-mono); padding: 2px 5px; border-radius: 3px; background: #000; border: 1px solid #444; }

        /* MAP & CANVAS */
        #map-wrapper { position: relative; background: #020202; overflow: hidden; box-shadow: inset 0 0 100px #000; }
        #map-canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }
        
        #map-hud { position: absolute; top: 15px; left: 15px; display: flex; flex-direction: column; gap: 8px; }
        .map-filter { 
            background: rgba(0,0,0,0.8); color: #aaa; border: 1px solid #444; padding: 8px 12px; 
            font-size: 11px; cursor: pointer; backdrop-filter: blur(5px); font-weight: 700;
            text-transform: uppercase; width: 120px; text-align: center; border-radius: 2px;
            transition: 0.2s;
        }
        .map-filter:hover, .map-filter.active { border-color: var(--c-blue); color: var(--c-blue); box-shadow: 0 0 15px rgba(0, 243, 255, 0.15); }

        #province-tooltip {
            position: absolute; bottom: 20px; right: 20px; width: 300px;
            background: var(--overlay); border: 1px solid var(--c-blue);
            padding: 15px; backdrop-filter: blur(10px); display: none; border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); z-index: 50; animation: slideUp 0.3s;
        }

        /* NEWS TICKER */
        #ticker-bar {
            height: 30px; background: var(--c-gold); color: #000;
            display: flex; align-items: center; overflow: hidden; white-space: nowrap;
            font-family: var(--font-mono); font-weight: 800; font-size: 14px;
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 200; border-top: 2px solid #000;
        }
        .ticker-item { margin-right: 50px; display: inline-block; }

        /* MODALS */
        .modal-bg {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal {
            width: 700px; max-height: 90vh; background: #0d1117; border: 1px solid #333;
            display: flex; flex-direction: column; box-shadow: 0 0 100px rgba(0,0,0,0.8); border-radius: 6px;
            animation: zoomIn 0.2s;
        }
        .modal-head { background: #161b22; padding: 15px 20px; font-family: var(--font-head); font-size: 26px; color: #fff; border-bottom: 1px solid #333; display:flex; justify-content:space-between; align-items: center; }
        .modal-body { padding: 20px; overflow-y: auto; color: #ccc; line-height: 1.6; font-size: 14px; }
        .modal-foot { padding: 15px; border-top: 1px solid #333; display: flex; justify-content: flex-end; gap: 10px; background: #161b22; }

        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(0.98); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes scroll { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }

    </style>
</head>
<body>

<!-- TOP HUD -->
<div id="top-hud">
    <div class="hud-logo">AETERNA <span style="color:var(--c-blue)">OMEGA</span> <span style="font-size:12px; color:#666">v7.0</span></div>

    <div class="metric-group">
        <div class="metric" title="Hazine (Nakit Akışı)">
            <span class="metric-val" id="val-money">$0 M</span>
            <span class="metric-lbl"><i class="fa-solid fa-sack-dollar metric-icon"></i> HAZİNE</span>
        </div>
        <div class="metric" title="Politik Güç (PP)">
            <span class="metric-val" id="val-pp" style="color:var(--c-gold)">0</span>
            <span class="metric-lbl"><i class="fa-solid fa-crown metric-icon"></i> GÜÇ</span>
        </div>
        <div class="metric" title="Uluslararası Prestij">
            <span class="metric-val" id="val-pres" style="color:var(--c-purple)">0</span>
            <span class="metric-lbl"><i class="fa-solid fa-star metric-icon"></i> PRESTİJ</span>
        </div>
    </div>

    <div class="metric-group">
        <div class="metric">
            <span class="metric-val" id="val-fuel" style="color:#aaa">0</span>
            <span class="metric-lbl"><i class="fa-solid fa-gas-pump metric-icon"></i> YAKIT</span>
        </div>
        <div class="metric">
            <span class="metric-val" id="val-ammo" style="color:var(--c-orange)">0</span>
            <span class="metric-lbl"><i class="fa-solid fa-box metric-icon"></i> MÜHİMMAT</span>
        </div>
        <div class="metric">
            <span class="metric-val" id="val-stab" style="color:var(--c-green)">0%</span>
            <span class="metric-lbl"><i class="fa-solid fa-scale-balanced metric-icon"></i> İSTİKRAR</span>
        </div>
    </div>

    <div style="flex:1; display:flex; justify-content:center;">
        <div class="defcon-panel" id="defcon-disp" onclick="game.mil.toggleDefcon()">DEFCON 5</div>
    </div>

    <div class="date-display">
        <div class="date-main" id="date-main">01 OCAK 2026</div>
        <div style="font-size:10px; color:#666; cursor:pointer;" onclick="game.togglePause()" id="pause-status">[ SPACE: DURDUR ]</div>
    </div>
</div>

<!-- VIEWPORT -->
<div id="viewport">
    
    <!-- LEFT: STATECRAFT -->
    <div class="panel">
        <div class="tabs">
            <button class="tab-btn active" onclick="ui.tab('l', 'pol')"><i class="fa-solid fa-landmark"></i></button>
            <button class="tab-btn" onclick="ui.tab('l', 'eco')"><i class="fa-solid fa-chart-line"></i></button>
            <button class="tab-btn" onclick="ui.tab('l', 'soc')"><i class="fa-solid fa-users"></i></button>
            <button class="tab-btn" onclick="ui.tab('l', 'res')"><i class="fa-solid fa-flask"></i></button>
        </div>

        <!-- POLITICS -->
        <div id="tab-l-pol" class="content-area active">
            <div class="card">
                <div class="card-header">DEVLET YÖNETİMİ</div>
                <div class="stat-row"><span>Lider:</span> <span style="color:var(--c-blue)">Başkan [OYUNCU]</span></div>
                <div class="stat-row"><span>İdeoloji:</span> <span>Teknokratik Otoriter</span></div>
                <div class="stat-row"><span>Parlamento Desteği:</span> <span id="pol-parl">55%</span></div>
                <div class="progress-bar"><div class="progress-fill" id="bar-parl" style="width:55%; background:var(--c-green)"></div></div>
            </div>

            <div class="card">
                <div class="card-header">SİYASİ AKSİYONLAR</div>
                <button class="btn" onclick="game.pol.action('election')">
                    <span><i class="fa-solid fa-check-to-slot"></i> Erken Seçim</span> <span class="btn-tag">500 PP</span>
                </button>
                <button class="btn" onclick="game.pol.action('purge')">
                    <span><i class="fa-solid fa-skull"></i> Parti İçi Temizlik</span> <span class="btn-tag">100 PP / -Hukuk</span>
                </button>
                <button class="btn" onclick="game.pol.action('referendum')">
                    <span><i class="fa-solid fa-scroll"></i> Anayasa Referandumu</span> <span class="btn-tag">250 PP</span>
                </button>
                <button class="btn btn-danger" onclick="game.pol.action('martial')">
                    <span><i class="fa-solid fa-person-military-pointing"></i> Sıkıyönetim İlanı</span> <span class="btn-tag">1000 PP</span>
                </button>
            </div>

            <div class="card">
                <div class="card-header">ULUSLARARASI KURUMLAR</div>
                <div class="stat-row"><span>BM Güvenlik Konseyi:</span> <span>Üye Değil</span></div>
                <div class="stat-row"><span>NATO Durumu:</span> <span style="color:var(--c-blue)">Müttefik</span></div>
                <button class="btn" onclick="game.pol.unVote()">
                    <span>BM Oylamasına Katıl</span> <span class="btn-tag">Prestij</span>
                </button>
            </div>
        </div>

        <!-- ECONOMY -->
        <div id="tab-l-eco" class="content-area">
            <div class="card">
                <div class="card-header">MAKROEKONOMİ & BORSA</div>
                <div class="stat-row"><span>GSYİH:</span> <span id="eco-gdp">$950B</span></div>
                <div class="stat-row"><span>Enflasyon:</span> <span id="eco-inf" style="color:var(--c-red)">12.5%</span></div>
                <div class="stat-row"><span>Dış Borç:</span> <span id="eco-debt">$320B</span></div>
                <button class="btn" onclick="game.eco.lunder()">
                    <span><i class="fa-solid fa-money-bill-transfer"></i> Kara Para Aklama</span> <span class="btn-tag">+$2B / Riskli</span>
                </button>
            </div>

            <div class="card">
                <div class="card-header">KAYNAK YÖNETİMİ</div>
                <button class="btn" onclick="game.eco.buy('oil')">
                    <span>Petrol İthalatı (1000 varil)</span> <span class="btn-tag">-$50M</span>
                </button>
                <button class="btn" onclick="game.eco.buy('rare')">
                    <span>Nadir Element Al</span> <span class="btn-tag">-$100M</span>
                </button>
                <button class="btn" onclick="game.eco.build('fac')">
                    <span>Yeni Fabrika İnşa Et</span> <span class="btn-tag">-$500M</span>
                </button>
                <button class="btn" onclick="game.eco.energy('nuc')">
                    <span>Nükleer Santral Yatırımı</span> <span class="btn-tag">-$5B</span>
                </button>
            </div>
        </div>

        <!-- SOCIETY -->
        <div id="tab-l-soc" class="content-area">
            <div class="card">
                <div class="card-header">İÇ GÜVENLİK & TOPLUM</div>
                <div class="stat-row"><span>Halk Mutluluğu:</span> <span id="soc-hap">45%</span></div>
                <div class="stat-row"><span>Terör Riski:</span> <span id="soc-ter" style="color:var(--c-red)">YÜKSEK</span></div>
                <div class="progress-bar"><div class="progress-fill" id="bar-ter" style="width:75%; background:var(--c-red)"></div></div>
            </div>
            
            <div class="card">
                <div class="card-header">MEDYA & İSTİHBARAT</div>
                <button class="btn" onclick="game.soc.propaganda()">
                    <span><i class="fa-solid fa-bullhorn"></i> Ulusal Propaganda</span> <span class="btn-tag">Medya</span>
                </button>
                <button class="btn" onclick="game.soc.raid()">
                    <span><i class="fa-solid fa-handcuffs"></i> Terör Operasyonu</span> <span class="btn-tag">Polis</span>
                </button>
                <button class="btn" onclick="game.soc.censorship()">
                    <span><i class="fa-solid fa-eye-slash"></i> Sosyal Medya Kısıtlaması</span> <span class="btn-tag">Otorite</span>
                </button>
            </div>
        </div>

        <!-- RESEARCH -->
        <div id="tab-l-res" class="content-area">
            <div class="card">
                <div class="card-header">AR-GE MERKEZİ</div>
                <div style="text-align:center; font-size:24px; color:var(--c-blue); margin:10px;">
                    RP: <span id="val-rp">0.0</span>
                </div>
                <div id="tech-list"></div>
            </div>
        </div>
    </div>

    <!-- CENTER: MAP -->
    <div class="panel" id="map-wrapper">
        <canvas id="map-canvas"></canvas>
        
        <div id="map-hud">
            <button class="map-filter active" onclick="map.mode='pol'">POLİTİK</button>
            <button class="map-filter" onclick="map.mode='mil'">ASKERİ CEPHE</button>
            <button class="map-filter" onclick="map.mode='eco'">KAYNAK</button>
            <button class="map-filter" onclick="map.mode='spy'">İSTİHBARAT AĞI</button>
        </div>

        <div id="province-tooltip">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span id="p-name" style="font-size:20px; font-weight:700; color:var(--c-blue)">BÖLGE</span>
                <span id="p-owner">Biz</span>
            </div>
            <div class="stat-row"><span>Sadakat:</span> <span id="p-loy">100%</span></div>
            <div class="stat-row"><span>Altyapı:</span> <span id="p-inf">100%</span></div>
            <div class="stat-row"><span>Direniş:</span> <span id="p-risk" style="color:var(--c-red)">0%</span></div>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px;">
                <button class="btn btn-tag" onclick="game.mapAct('invest')">YATIRIM ($100)</button>
                <button class="btn btn-tag" onclick="game.mapAct('fort')">SAVUNMA</button>
                <button class="btn btn-tag btn-danger" onclick="game.mapAct('suppress')">BASKIN</button>
                <button class="btn btn-tag btn-danger" onclick="game.mapAct('nuke')" id="btn-nuke" disabled>☢️ ATOM</button>
            </div>
        </div>
    </div>

    <!-- RIGHT: WAR & DIPLOMACY -->
    <div class="panel">
        <div class="tabs">
            <button class="tab-btn active" onclick="ui.tab('r', 'mil')"><i class="fa-solid fa-jet-fighter"></i></button>
            <button class="tab-btn" onclick="ui.tab('r', 'dip')"><i class="fa-solid fa-globe"></i></button>
            <button class="tab-btn" onclick="ui.tab('r', 'spy')"><i class="fa-solid fa-user-secret"></i></button>
        </div>

        <!-- MILITARY -->
        <div id="tab-r-mil" class="content-area active">
            <div class="card">
                <div class="card-header">GENELKURMAY</div>
                <div class="stat-row"><span>İnsan Gücü:</span> <span id="mil-man">1.2M</span></div>
                <div class="stat-row"><span>Lojistik Ağı:</span> <span id="mil-log" style="color:var(--c-orange)">%90</span></div>
                <div class="stat-row"><span>Savaş Yorgunluğu:</span> <span id="mil-fat">%0</span></div>
                
                <div class="stat-row" style="margin-top:10px;">
                    <select id="mil-doc" style="width:100%; background:#111; color:#fff; padding:5px; border:1px solid #444;" onchange="game.mil.setDoctrine(this.value)">
                        <option value="def">Tam Savunma (Defans +%20)</option>
                        <option value="blitz">Yıldırım Harbi (Hız +%30)</option>
                        <option value="guerilla">Asimetrik Harp (Düşük Maliyet)</option>
                        <option value="shock">Şok ve Dehşet (Hava +%50)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">ENVANTER & ÜRETİM</div>
                <div class="stat-row"><i class="fa-solid fa-person-rifle"></i> Piyade <span id="u-inf">0</span> <button class="btn-tag" onclick="game.mil.train('inf')">+EĞİT</button></div>
                <div class="stat-row"><i class="fa-solid fa-tank"></i> Zırhlı <span id="u-tank">0</span> <button class="btn-tag" onclick="game.mil.train('tank')">+ÜRET</button></div>
                <div class="stat-row"><i class="fa-solid fa-jet-fighter"></i> Hava K. <span id="u-air">0</span> <button class="btn-tag" onclick="game.mil.train('air')">+ÜRET</button></div>
                <div class="stat-row"><i class="fa-solid fa-ship"></i> Donanma <span id="u-sea">0</span> <button class="btn-tag" onclick="game.mil.train('sea')">+İNŞA</button></div>
                <div class="stat-row"><i class="fa-solid fa-robot"></i> AI/Drone <span id="u-drone">0</span> <button class="btn-tag" onclick="game.mil.train('drone')">+ÜRET</button></div>
                <div class="stat-row"><i class="fa-solid fa-satellite"></i> Uzay K. <span id="u-space">0</span> <button class="btn-tag" onclick="game.mil.train('space')">+FIRLAT</button></div>
            </div>
            
             <div class="card">
                <div class="card-header">SİBER HARP</div>
                <button class="btn" onclick="game.mil.cyberAttack()">
                     <span><i class="fa-solid fa-wifi"></i> Düşman Radarını Kör Et</span> <span class="btn-tag">100 INT</span>
                </button>
            </div>
        </div>

        <!-- DIPLOMACY -->
        <div id="tab-r-dip" class="content-area">
            <div class="card">
                <div class="card-header">DÜNYA ULUSLARI</div>
                <div id="dip-list"></div>
            </div>

            <div id="dip-actions" style="display:none;" class="card">
                <div class="card-header" id="dip-target">HEDEF ÜLKE</div>
                <button class="btn" onclick="game.dip.act('improve')">İlişkileri Geliştir</button>
                <button class="btn" onclick="game.dip.act('trade')">Ticaret Anlaşması</button>
                <button class="btn" onclick="game.dip.act('alliance')">İttifak Teklif Et</button>
                <button class="btn btn-danger" onclick="game.dip.act('embargo')">Ambargo Uygula</button>
                <button class="btn btn-danger" onclick="game.dip.act('sanction')">Ekonomik Yaptırım</button>
                <button class="btn btn-danger" onclick="game.dip.act('war')">SAVAŞ İLAN ET</button>
            </div>
        </div>

        <!-- INTEL (SPY) -->
        <div id="tab-r-spy" class="content-area">
            <div class="card">
                <div class="card-header">GİZLİ SERVİS (MİT/CIA/KGB)</div>
                <button class="btn" onclick="game.intel.op('coup')">
                    <span><i class="fa-solid fa-user-ninja"></i> Hükümet Devirme (Darbe)</span> <span class="btn-tag">500 INT</span>
                </button>
                <button class="btn" onclick="game.intel.op('assassin')">
                    <span><i class="fa-solid fa-skull-crossbones"></i> Lider Suikasti</span> <span class="btn-tag">1000 INT</span>
                </button>
                <button class="btn" onclick="game.intel.op('steal')">
                    <span><i class="fa-solid fa-microchip"></i> Teknoloji Çal</span> <span class="btn-tag">250 INT</span>
                </button>
                <button class="btn" onclick="game.intel.op('sabotage')">
                    <span><i class="fa-solid fa-bomb"></i> Endüstriyel Sabotaj</span> <span class="btn-tag">150 INT</span>
                </button>
            </div>
            <div id="spy-log" style="font-family:var(--font-mono); font-size:10px; height:250px; overflow-y:auto; color:var(--c-grey); border-top:1px solid #333; padding-top:5px;">
                <div style="color:var(--c-green)">> KRİPTO AĞI AKTİF...</div>
            </div>
        </div>
    </div>
</div>

<!-- NEWS TICKER -->
<div id="ticker-bar">
    <div style="animation: scroll 60s linear infinite; padding-left: 100vw;" id="ticker-content">
        +++ KÜRESEL GÜNDEM: PETROL FİYATLARI REKOR KIRDI +++ BM GÜVENLİK KONSEYİ ACİL TOPLANDI +++ YENİ PANDEMİ RİSKİ BELİRDİ +++ SİBER SALDIRILAR AVRUPA'YI FELÇ ETTİ +++
    </div>
</div>

<!-- MODAL SYSTEM -->
<div class="modal-bg" id="modal-wrap">
    <div class="modal">
        <div class="modal-head">
            <span id="m-title">BAŞLIK</span>
            <i class="fa-solid fa-triangle-exclamation" style="color:var(--c-red)"></i>
        </div>
        <div class="modal-body" id="m-body">
            İçerik...
        </div>
        <div class="modal-foot" id="m-foot">
            <button class="btn" style="width:auto">KAPAT</button>
        </div>
    </div>
</div>

<script>
/**
 * AETERNA: OMEGA ENGINE v7.0 (GRAND ARCHITECT)
 * - Full Grand Strategy implementation in a single file.
 * - Advanced AI, Economy, Military, Diplomacy, Espionage.
 */

/* --- CONFIG & DATA --- */
const CONFIG = {
    tickRate: 800, // ms per day
    startYear: 2026,
    colors: { pl: '#00f3ff', en: '#ff2a2a', al: '#0aff0a', ne: '#666', te:'#fff' }
};

const DATA = {
    nations: [
        { id:'us', n:'ABD', pwr:100, bloc:'NATO', trait:'Imperialist', rel:50 },
        { id:'ru', n:'Rusya', pwr:90, bloc:'EAST', trait:'Aggressive', rel:30 },
        { id:'cn', n:'Çin', pwr:95, bloc:'EAST', trait:'Economic', rel:40 },
        { id:'eu', n:'Avrupa B.', pwr:85, bloc:'NATO', trait:'Diplomatic', rel:70 },
        { id:'gr', n:'Yunanistan', pwr:25, bloc:'NATO', trait:'Hostile', rel:10 },
        { id:'ir', n:'İran', pwr:40, bloc:'EAST', trait:'Theocratic', rel:45 },
        { id:'il', n:'İsrail', pwr:50, bloc:'NATO', trait:'Militarist', rel:55 },
        { id:'sy', n:'Suriye', pwr:10, bloc:'None', trait:'Chaos', rel:20 },
        { id:'uk', n:'İngiltere', pwr:70, bloc:'NATO', trait:'Diplomatic', rel:65 }
    ],
    techs: [
        { id:'t1', n:'Yapay Zeka Savunma', c:500, i:'fa-brain' },
        { id:'t2', n:'Hipersonik Füzeler', c:800, i:'fa-rocket' },
        { id:'t3', n:'Kuantum Şifreleme', c:600, i:'fa-lock' },
        { id:'t4', n:'Füzyon Enerjisi', c:1500, i:'fa-atom' },
        { id:'t5', n:'Uzay Lazerleri (ODIN)', c:3000, i:'fa-satellite' },
        { id:'t6', n:'Biyo-Genetik Asker', c:1000, i:'fa-dna' },
        { id:'t7', n:'Görünmezlik (Stealth)', c:1200, i:'fa-plane' }
    ],
    provinces: [
        { id:0, n:'Ankara', x:400, y:250, o:'pl', t:'city', pop:6, res:'none' },
        { id:1, n:'İstanbul', x:300, y:180, o:'pl', t:'ind', pop:16, res:'trade' },
        { id:2, n:'İzmir', x:250, y:300, o:'pl', t:'port', pop:4, res:'trade' },
        { id:3, n:'Antalya', x:350, y:400, o:'pl', t:'tour', pop:2, res:'agri' },
        { id:4, n:'Diyarbakır', x:600, y:300, o:'pl', t:'city', pop:2, res:'oil' },
        { id:5, n:'Erzurum', x:550, y:200, o:'pl', t:'mil', pop:1, res:'mine' },
        { id:6, n:'Atina', x:150, y:350, o:'gr', t:'cap', pop:4, res:'trade' },
        { id:7, n:'Selanik', x:180, y:220, o:'gr', t:'port', pop:1, res:'trade' },
        { id:8, n:'Şam', x:600, y:450, o:'sy', t:'war', pop:3, res:'none' },
        { id:9, n:'Halep', x:620, y:400, o:'sy', t:'war', pop:2, res:'oil' },
        { id:10, n:'Tahran', x:800, y:300, o:'ir', t:'cap', pop:8, res:'oil' },
        { id:11, n:'Moskova', x:600, y:50, o:'ru', t:'cap', pop:12, res:'gas' },
        { id:12, n:'Kıbrıs', x:450, y:450, o:'pl', t:'strat', pop:1, res:'gas' },
        { id:13, n:'Bakü', x:750, y:200, o:'az', t:'oil', pop:3, res:'oil' }
    ]
};

/* --- CORE ENGINE --- */
const game = {
    state: {
        date: new Date(2026, 0, 1),
        paused: false,
        res: { money: 1000, pp: 500, intel: 100, fuel: 1000, ammo: 1000, rp: 0, rare: 50 },
        stats: { gdp: 950, debt: 320, stab: 60, defcon: 5, inf: 12, pres: 50 },
        mil: { man: 1200, log: 90, fat: 0, doc: 'def', units: { inf:50, tank:10, air:5, sea:4, drone:20, space:0 } },
        rel: {}, // Diplomacy map
        provs: [],
        events: []
    },
    
    selProv: null,
    selNat: null,
    timer: null,

    init() {
        console.log("AETERNA OMEGA v7 BOOT SEQUENCE...");
        
        // Init Provinces
        DATA.provinces.forEach(p => {
            this.state.provs.push({
                ...p,
                loy: p.o==='pl'?95:10,
                risk: p.o==='sy'?90:5,
                inf: 80,
                def: 50
            });
        });

        // Init Diplomacy
        DATA.nations.forEach(n => {
            this.state.rel[n.id] = { val: n.rel, war: false, trd: false, aly: false, emb: false };
        });

        ui.init();
        map.init();
        this.loop();
    },

    loop() {
        if(this.timer) clearInterval(this.timer);
        this.timer = setInterval(() => {
            if(!this.state.paused) this.tick();
        }, CONFIG.tickRate);
    },

    tick() {
        const s = this.state;
        s.date.setDate(s.date.getDate() + 1);
        
        // 1. Module Updates
        this.eco.tick();
        this.mil.tick();
        this.ai.tick();
        this.pol.tick();
        
        // 2. Random Events
        if(Math.random() < 0.03) this.ai.randomEvent();

        ui.update();
        map.draw();
    },

    togglePause() {
        this.state.paused = !this.state.paused;
        document.getElementById('pause-status').innerText = this.state.paused ? "[ DURAKLATILDI ]" : "[ SPACE: DURDUR ]";
    },

    /* --- MODULES --- */
    
    // POLITICS MODULE
    pol: {
        tick() {
            game.state.res.pp += 0.5;
            game.state.stats.pres = Math.min(100, game.state.stats.pres + 0.01);
        },
        action(type) {
            const s = game.state;
            if(type === 'election') {
                if(s.res.pp >= 500) { s.res.pp-=500; s.stats.stab+=15; ui.alert("Seçim Sonuçları", "Halk güven tazeledi. İstikrar arttı."); }
            }
            if(type === 'purge') {
                if(s.res.pp >= 100) { s.res.pp-=100; s.stats.stab+=5; ui.log("Parti içi temizlik yapıldı.", 'orange'); }
            }
            if(type === 'martial') {
                if(s.res.pp >= 1000) { s.res.pp-=1000; s.stats.stab=100; s.stats.gdp*=0.8; ui.alert("SIKIYÖNETİM", "Ordu yönetime el koydu. Ekonomi çöktü ama düzen sağlandı."); }
            }
        },
        unVote() {
            if(Math.random() > 0.5) {
                game.state.stats.pres += 10;
                ui.alert("BM Oylaması", "Tasarı lehimize sonuçlandı. Prestij kazandık.");
            } else {
                game.state.stats.pres -= 5;
                ui.alert("BM Oylaması", "Veto yedik. Prestij kaybı.");
            }
        }
    },

    // ECONOMY MODULE
    eco: {
        tick() {
            const s = game.state;
            // Income
            const daily = (s.stats.gdp * 0.001) - (s.stats.debt * 0.0001);
            const milCost = game.mil.calcCost();
            s.res.money += daily - milCost;
            
            // Inflation Logic
            if(s.res.money < 0) { s.stats.debt += 1; s.stats.inf += 0.05; }
            if(s.stats.inf > 50) ui.log("HİPERENFLASYON UYARISI!", 'red');
        },
        buy(res) {
            const s = game.state;
            if(res==='oil' && s.res.money>=50) { s.res.money-=50; s.res.fuel+=1000; ui.log("Petrol ithal edildi."); }
            if(res==='rare' && s.res.money>=100) { s.res.money-=100; s.res.rare+=100; ui.log("Nadir element alındı."); }
        },
        lunder() {
            const s = game.state;
            if(Math.random() > 0.4) {
                s.res.money += 2; // Billion
                ui.log("Kara para başarıyla sisteme sokuldu.", 'lime');
            } else {
                s.stats.pres -= 5;
                s.stats.stab -= 2;
                ui.alert("SKANDAL!", "Para aklama operasyonu deşifre oldu. Uluslararası itibar zedelendi.");
            }
        },
        build(type) {
            if(game.state.res.money >= 0.5) {
                game.state.res.money -= 0.5;
                game.state.stats.gdp += 10;
                ui.log("Sanayi yatırımı tamamlandı.");
            }
        }
    },

    // MILITARY MODULE
    mil: {
        tick() {
            const s = game.state;
            // Fuel/Ammo Consumption based on units
            const usage = (s.mil.units.tank * 0.5) + (s.mil.units.air * 2) + (s.mil.units.sea * 3);
            s.res.fuel -= usage * 0.1;
            
            // Logistics Check
            if(s.res.fuel <= 0) {
                s.res.fuel = 0;
                s.mil.log = Math.max(10, s.mil.log - 1);
                if(Math.random()<0.1) ui.log("KRİTİK: YAKIT BİTTİ! Birlikler hareket edemiyor.", 'red');
            } else {
                s.mil.log = Math.min(100, s.mil.log + 0.5);
            }
            
            this.simCombat();
        },
        calcCost() {
            const u = game.state.mil.units;
            return (u.inf*0.01 + u.tank*0.05 + u.air*0.2 + u.sea*0.3 + u.space*1);
        },
        train(type) {
            const costs = { inf:10, tank:50, air:200, sea:300, drone:30, space:1000 };
            const cost = costs[type];
            if(game.state.res.money >= cost/1000) {
                game.state.res.money -= cost/1000;
                game.state.mil.units[type]++;
                ui.log(`${type.toUpperCase()} birliği envantere girdi.`);
            }
        },
        setDoctrine(d) {
            game.state.mil.doc = d;
            ui.log(`Doktrin değişti: ${d.toUpperCase()}`);
        },
        toggleDefcon() {
            let d = game.state.stats.defcon - 1;
            if(d < 1) d = 5;
            game.state.stats.defcon = d;
            ui.update();
        },
        cyberAttack() {
            if(game.state.res.intel >= 100) {
                game.state.res.intel -= 100;
                ui.log("Düşman radar sistemlerine siber saldırı başlatıldı...", 'cyan');
            }
        },
        simCombat() {
            // Check wars
            game.state.provs.forEach(p => {
                if(p.o === 'pl' && p.risk > 80) {
                    if(Math.random() < 0.1) {
                        game.state.mil.units.inf -= 1;
                        game.state.stats.stab -= 1;
                        ui.log(`ÇATIŞMA: ${p.n} bölgesinde terör saldırısı! Kayıp verdik.`, 'red');
                    }
                }
            });
        }
    },

    // DIPLOMACY MODULE
    dip: {
        act(type) {
            if(!game.selNat) return;
            const nid = game.selNat.id;
            const d = game.state.rel[nid];
            const pp = game.state.res.pp;

            if(type === 'improve') {
                if(pp >= 50) { game.state.res.pp-=50; d.val+=10; ui.log("Diplomatik nota gönderildi."); }
            }
            if(type === 'alliance') {
                if(d.val > 80) { d.aly = true; ui.alert("İTTİFAK", `${game.selNat.n} ile müttefik oldunuz!`); }
                else ui.log("İttifak teklifi reddedildi.", 'red');
            }
            if(type === 'war') {
                ui.modal("SAVAŞ İLANI", `${game.selNat.n} ile savaşa giriyorsunuz. Bu geri dönülemez.`, [
                    { t:"SALDIR", c:'btn-danger', f:()=>{ 
                        d.war=true; game.state.stats.defcon=1; 
                        ui.alert("SAVAŞ BAŞLADI", "Genelkurmay harekât planını devreye soktu."); 
                        ui.closeModal(); 
                    }},
                    { t:"İPTAL", c:'btn', f:()=>ui.closeModal() }
                ]);
            }
            ui.refreshDip();
        }
    },

    // INTEL MODULE
    intel: {
        op(type) {
            const cost = { coup:500, assassin:1000, steal:250, sabotage:150 }[type];
            if(game.state.res.intel >= cost) {
                game.state.res.intel -= cost;
                
                setTimeout(() => {
                    const success = Math.random() > 0.5;
                    if(success) {
                        ui.alert("OPERASYON BAŞARILI", `${type.toUpperCase()} operasyonu hedefe ulaştı.`);
                        if(type==='steal') { game.state.res.rp += 500; ui.log("Teknoloji çalındı: +500 RP", 'lime'); }
                        if(type==='coup') ui.log("Hedef ülkede rejim değişti.", 'lime');
                    } else {
                        ui.alert("OPERASYON DEŞİFRE OLDU", "Ajanlarımız yakalandı. Uluslararası kriz!", 'red');
                        game.state.stats.pres -= 20;
                    }
                }, 2000);
                
                ui.log("Ajanlar sahaya iniyor...", 'cyan');
            } else {
                ui.log("Yetersiz İstihbarat Ağı!", 'red');
            }
        }
    },

    // SOCIAL MODULE
    soc: {
        propaganda() {
            if(game.state.res.pp >= 50) {
                game.state.res.pp -= 50;
                game.state.stats.stab += 5;
                ui.log("Ulusal kanallarda propaganda yapıldı.");
            }
        },
        raid() {
            game.state.provs.forEach(p => { if(p.o==='pl') p.risk = Math.max(0, p.risk-10); });
            ui.log("Polis özel harekat baskınları düzenledi.");
        },
        censorship() {
            game.state.stats.stab += 2;
            game.state.stats.pres -= 1;
            ui.log("İnternet bant genişliği daraltıldı.");
        }
    },

    // MAP ACTIONS
    mapAct(type) {
        if(game.selProv === null) return;
        const p = game.state.provs[game.selProv];
        
        if(type==='invest' && game.state.res.money>=0.1) {
            game.state.res.money-=0.1; p.inf+=5; ui.log(`${p.n} altyapısı geliştirildi.`);
        }
        if(type==='nuke') {
            ui.modal("NÜKLEER SALDIRI ONAYI", "Milyonlarca insan ölecek. Onaylıyor musunuz?", [
                { t:"ATEŞLE", c:'btn-danger', f:()=>{
                    p.pop=0; p.inf=0; ui.alert("KIYAMET", "Nükleer başlık patladı."); ui.closeModal();
                }},
                { t:"İPTAL", c:'btn', f:()=>ui.closeModal() }
            ]);
        }
        ui.update();
    },

    // AI & EVENTS
    ai: {
        tick() {
            // Nations act based on traits
            DATA.nations.forEach(n => {
                if(game.state.rel[n.id].war && Math.random()<0.05) {
                    ui.log(`${n.n} cephesinde ağır bombardıman!`, 'red');
                }
            });
        },
        randomEvent() {
            const evs = [
                "Küresel Petrol Krizi: Yakıt Fiyatları Arttı!",
                "Komşu Ülkede İç Savaş Çıktı.",
                "Siber Saldırı: Bankacılık Sistemi Çöktü.",
                "Yeni Bir Pandemi Uyarısı!",
                "Mülteci Dalgası Sınıra Dayandı."
            ];
            const e = evs[Math.floor(Math.random()*evs.length)];
            ui.ticker(e);
            
            // Randomly affect stats
            if(Math.random()<0.5) game.state.stats.gdp -= 5;
        },
        nationAct() {
            // AI Logic placeholder
        }
    }
};

/* --- UI CONTROLLER --- */
const ui = {
    init() {
        // Render Techs
        const tc = document.getElementById('tech-list');
        DATA.techs.forEach(t => {
            tc.innerHTML += `<div class="btn">
                <span><i class="fa-solid ${t.i}"></i> ${t.n}</span>
                <span class="btn-tag">${t.c} RP</span>
            </div>`;
        });
        
        this.refreshDip();
    },

    update() {
        const s = game.state;
        
        // Metrics
        document.getElementById('val-money').innerText = '$' + s.res.money.toFixed(1) + 'B';
        document.getElementById('val-pp').innerText = Math.floor(s.res.pp);
        document.getElementById('val-pres').innerText = Math.floor(s.stats.pres);
        document.getElementById('val-fuel').innerText = Math.floor(s.res.fuel);
        document.getElementById('val-ammo').innerText = Math.floor(s.res.ammo);
        document.getElementById('val-stab').innerText = Math.floor(s.stats.stab) + '%';
        
        document.getElementById('date-main').innerText = s.date.toLocaleDateString('tr-TR');
        
        // Defcon
        const d = document.getElementById('defcon-disp');
        d.innerText = "DEFCON " + s.stats.defcon;
        d.style.background = s.stats.defcon===1 ? 'var(--c-red)' : 'rgba(50,0,0,0.4)';
        
        // Unit Counts
        const u = s.mil.units;
        document.getElementById('u-inf').innerText = u.inf;
        document.getElementById('u-tank').innerText = u.tank;
        document.getElementById('u-air').innerText = u.air;
        document.getElementById('u-sea').innerText = u.sea;
        document.getElementById('u-drone').innerText = u.drone;
        document.getElementById('u-space').innerText = u.space;

        // Province Detail
        if(game.selProv !== null) {
            const p = game.state.provs[game.selProv];
            document.getElementById('p-inf').innerText = Math.floor(p.inf) + '%';
            document.getElementById('p-loy').innerText = Math.floor(p.loy) + '%';
            document.getElementById('p-risk').innerText = Math.floor(p.risk) + '%';
            document.getElementById('btn-nuke').disabled = (s.stats.defcon > 1);
        }
        
        // RP
        game.state.res.rp += 0.1;
        document.getElementById('val-rp').innerText = s.res.rp.toFixed(1);
    },

    refreshDip() {
        const c = document.getElementById('dip-list');
        c.innerHTML = '';
        DATA.nations.forEach(n => {
            const d = game.state.rel[n.id];
            let col = '#888';
            if(d.war) col = 'var(--c-red)';
            else if(d.aly) col = 'var(--c-green)';
            else if(d.val > 60) col = 'var(--c-blue)';
            
            const el = document.createElement('div');
            el.className = 'btn';
            el.innerHTML = `<span>${n.n}</span> <span style="color:${col}; font-weight:bold">${d.val}</span>`;
            el.onclick = () => {
                game.selNat = n;
                document.getElementById('dip-actions').style.display = 'block';
                document.getElementById('dip-target').innerText = n.n;
            };
            c.appendChild(el);
        });
    },

    tab(side, id) {
        const idx = side==='l' ? 0 : 2;
        const panel = document.querySelectorAll('.panel')[idx];
        panel.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        panel.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById(`tab-${side}-${id}`).classList.add('active');
    },

    log(msg, color='#fff') {
        const l = document.getElementById('spy-log');
        l.innerHTML = `<div style="color:${color}; margin-bottom:4px; border-bottom:1px solid #222;">> ${msg}</div>` + l.innerHTML;
    },

    ticker(msg) {
        document.getElementById('ticker-content').innerText += " +++ " + msg;
    },

    modal(title, body, buttons) {
        document.getElementById('m-title').innerText = title;
        document.getElementById('m-body').innerText = body;
        const f = document.getElementById('m-foot');
        f.innerHTML = '';
        buttons.forEach(b => {
            const btn = document.createElement('button');
            btn.className = 'btn ' + (b.c || '');
            btn.style.width = 'auto';
            btn.innerText = b.t;
            btn.onclick = b.f;
            f.appendChild(btn);
        });
        document.getElementById('modal-wrap').style.display = 'flex';
    },
    
    closeModal() { document.getElementById('modal-wrap').style.display = 'none'; },
    
    alert(title, msg) {
        this.modal(title, msg, [{t:"TAMAM", f:()=>this.closeModal()}]);
    }
};

/* --- CANVAS MAP ENGINE --- */
const map = {
    cvs: null, ctx: null, mode: 'pol', particles: [],

    init() {
        this.cvs = document.getElementById('map-canvas');
        this.ctx = this.cvs.getContext('2d');
        
        // Resize
        const r = document.getElementById('map-wrapper');
        this.cvs.width = r.offsetWidth;
        this.cvs.height = r.offsetHeight;

        this.cvs.addEventListener('mousedown', e => this.click(e));
        this.animate();
    },

    draw() {
        const ctx = this.ctx;
        const w = this.cvs.width;
        const h = this.cvs.height;
        
        // BG
        ctx.fillStyle = '#020202';
        ctx.fillRect(0,0,w,h);
        
        // Grid
        ctx.strokeStyle = '#111'; ctx.lineWidth=1;
        for(let x=0; x<w; x+=50) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
        for(let y=0; y<h; y+=50) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }

        // Connections
        ctx.strokeStyle = '#222';
        game.state.provs.forEach((p1, i) => {
            game.state.provs.forEach((p2, j) => {
                if(i<j && Math.hypot(p1.x-p2.x, p1.y-p2.y) < 150) {
                    ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                }
            });
        });

        // Nodes
        game.state.provs.forEach(p => {
            let col = '#444';
            let r = 8 + (p.pop/2);
            
            // Mode Logic
            if(this.mode === 'pol') {
                if(p.o === 'pl') col = CONFIG.colors.pl;
                else if(p.o === 'sy') col = '#333';
                else {
                    const nat = DATA.nations.find(n => n.id === p.o);
                    if(nat) {
                         const rel = game.state.rel[nat.id];
                         col = rel.war ? CONFIG.colors.en : (rel.aly ? CONFIG.colors.al : CONFIG.colors.ne);
                    }
                }
            } else if(this.mode === 'mil') {
                col = `rgba(255, ${255-(p.risk*2)}, 0, 1)`;
            } else if(this.mode === 'eco') {
                col = p.res === 'oil' ? '#333' : (p.res === 'trade' ? CONFIG.colors.pl : '#666');
                if(p.res === 'oil') r += 2;
            }

            // Selection
            if(game.selProv === p.id) {
                ctx.shadowBlur = 20; ctx.shadowColor = '#fff'; ctx.fillStyle = '#fff';
            } else {
                ctx.shadowBlur = 10; ctx.shadowColor = col; ctx.fillStyle = col;
            }

            ctx.beginPath(); ctx.arc(p.x, p.y, r, 0, Math.PI*2); ctx.fill();
            
            // War Pulse
            if(p.risk > 80 && this.mode === 'mil') {
                ctx.strokeStyle = 'red'; ctx.lineWidth = 2;
                const pulse = r + Math.sin(Date.now()/200)*5;
                ctx.beginPath(); ctx.arc(p.x, p.y, pulse, 0, Math.PI*2); ctx.stroke();
            }

            // Label
            ctx.fillStyle = '#fff'; ctx.font = '11px Rajdhani'; ctx.textAlign = 'center'; ctx.shadowBlur=0;
            ctx.fillText(p.n, p.x, p.y - r - 8);
        });
    },

    animate() {
        this.draw();
        requestAnimationFrame(()=>this.animate());
    },

    click(e) {
        const rect = this.cvs.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        
        let hit = null;
        game.state.provs.forEach((p, i) => {
            if(Math.hypot(mx-p.x, my-p.y) < 20) hit = i;
        });

        if(hit !== null) {
            game.selProv = hit;
            const p = game.state.provs[hit];
            document.getElementById('province-tooltip').style.display = 'block';
            document.getElementById('p-name').innerText = p.n;
            ui.update();
        } else {
            game.selProv = null;
            document.getElementById('province-tooltip').style.display = 'none';
        }
    }
};

window.onload = () => game.init();

</script>
</body>
</html>
